<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content=""><meta name="keywords" content=""><meta name="author" content="y500"><meta name="copyright" content="y500"><title>stay hungry, stay foolish | study and record</title><link rel="shortcut icon" href="/melody-favicon.ico"><link rel="stylesheet" href="/css/index.css?version=1.9.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.9.0"><meta name="format-detection" content="telephone=no"><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/gitalk/dist/gitalk.min.css"><script src="https://cdn.jsdelivr.net/npm/gitalk@latest/dist/gitalk.min.js"></script><script src="https://cdn.jsdelivr.net/npm/blueimp-md5@2.10.0/js/md5.min.js"></script><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  hexoVersion: '4.2.0'
} </script><meta name="generator" content="Hexo 4.2.0"></head><body><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar" data-display="false"><div class="author-info"><div class="author-info__avatar text-center"><img src="/img/avatar.png"></div><div class="author-info__name text-center">y500</div><div class="author-info__description text-center"></div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">Articles</span><span class="pull-right">12</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">Tags</span><span class="pull-right">11</span></a><a class="author-info-articles__categories article-meta" href="/categories"><span class="pull-left">Categories</span><span class="pull-right">5</span></a></div></div></div><nav class="no-bg" id="nav"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">study and record</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right"></span></div><div id="site-info"><div id="site-title">study and record</div><div id="site-sub-title">stay hungry, stay foolish</div></div></nav><div id="content-outer"><div class="layout" id="content-inner"><div class="recent-post-item article-container"><a class="article-title" href="/2020/10/21/cli-upload-ipa-to-appsotre/">通过命令行上传ipa到appstore</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2020-10-21</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/Objective-C/">Objective-C</a></span><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/iOS/">iOS</a></span><div class="content"><p>搞持续集成自动化打包上传到appstore遇到这个问题，记录一下。</p>
<p>其实主要就一条到命令：<br><code>xcrun altool --upload-app -f xxxx.ipa -u &quot;yanqizhou@126.com&quot; -p &quot;*******&quot;</code></p>
<p>这里的密码不是App id的登录密码，是一个App专用的密码，如果使用登录密码会报错：<code>Please sign in with an app-specific password. You can create one at appleid.apple.com</code></p>
<ol>
<li>登录 <a href="https://appleid.apple.com/" target="_blank" rel="noopener">https://appleid.apple.com/</a></li>
<li>在安全栏有一个App 专用密码，点击生成一个</li>
<li>在命令中使用第二部生成的密码登录</li>
</ol>
<p>上传完会看到提示：<br><code>No errors uploading &#39;xxxx.ipa&#39;</code></p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2020/09/29/image-not-render-on-ios14/">iOS 14下面图片无法加载，包括weex、YYAnimateView、SDAnimatedImageView</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2020-09-29</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/Objective-C/">Objective-C</a></span><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/iOS/">iOS</a><span class="article-meta__link">-</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/weex/">weex</a><span class="article-meta__link">-</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/YYAnimateView/">YYAnimateView</a><span class="article-meta__link">-</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/SDAnimatedImageView/">SDAnimatedImageView</a></span><div class="content"><p>升级xcode12后，编译运行App发现大片大片的图片加载不出来，包括weex的图片和YYAnimateView的图片都有问题。</p>
<p>经过一番研究之后，发现是iOS 14下UIKit对 <code>displayLayer:</code>的处理机制有所变化。<br><code>displayLayer:</code>是<code>CALayerDelegate</code>的代理方法。在iOS 14之前，UIKit在调用这个方法之前就会去渲染<code>UIImageView.image</code>。<br>而在iOS 14，UIKit则是先去调用代理方法，如果你实现了<code>displayLayer:</code>这个方法，那么UIKit就不会再去渲染了。</p>
<p>如果改成下面这样就可以正常加载了：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">- (void)displayLayer:(CALayer *)layer &#123;</span><br><span class="line">    UIImage *currentFrame &#x3D; _curFrame;</span><br><span class="line">    if (currentFrame) &#123;</span><br><span class="line">        layer.contentsScale &#x3D; currentFrame.scale;</span><br><span class="line">        layer.contents &#x3D; (__bridge id)currentFrame.CGImage;</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        &#x2F;&#x2F; If we have no animation frames, call super implementation. iOS 14+ UIImageView use this delegate method for rendering.</span><br><span class="line">        if ([UIImageView instancesRespondToSelector:@selector(displayLayer:)]) &#123;</span><br><span class="line">           [super displayLayer:layer];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#x2F;&#x2F;    if (_curFrame) &#123;</span><br><span class="line">&#x2F;&#x2F;        layer.contents &#x3D; (__bridge id)_curFrame.CGImage;</span><br><span class="line">&#x2F;&#x2F;    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>参考：</p>
<ol>
<li><a href="https://github.com/apache/incubator-weex/issues/3265" target="_blank" rel="noopener">https://github.com/apache/incubator-weex/issues/3265</a></li>
<li><a href="https://github.com/ibireme/YYWebImage/issues/242" target="_blank" rel="noopener">https://github.com/ibireme/YYWebImage/issues/242</a></li>
<li><a href="https://github.com/SDWebImage/SDWebImage/issues/3040" target="_blank" rel="noopener">https://github.com/SDWebImage/SDWebImage/issues/3040</a></li>
</ol>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2020/09/27/ios14_taobao_uipasteboard/">iOS14剪切板探究，淘宝实现方法分析和实现Demo</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2020-09-27</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/Objective-C/">Objective-C</a></span><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/iOS/">iOS</a></span><div class="content"><p>随着iOS 14的发布，剪切板的滥用也被大家所知晓。只要是APP读取剪切板内容，系统都会在顶部弹出提醒，而且这个提醒不能够关闭。这样，大家在使用APP的过程中就能够看到哪些APP使用了剪切板。</p>
<p>正好我们自己的应用也使用了剪切板，升级了iOS 14之后弹的着实让人心烦。就想着怎么处理一下，翻了一下<code>UIPasteboard</code>的文档，发现相关的内容并不多。<br>读取<code>UIPasteboard</code>的<code>string</code>、<code>strings</code>、<code>URL</code>、<code>URLs</code>、<code>image</code>、<code>images</code>、<code>color</code>、<code>colors</code>的时候会触发系统提示。<br>使用<code>hasStrings</code>、<code>hasURLs</code>、<code>hasImages</code>、<code>hasColors</code>等方法的时候不会触发系统提示。<br>那么思路就是尽可能少的去调用会触发系统提示的方法，根据其他方法去判断确实需要读取的时候再去调用那些方法。<br>根据我们自己的情况，只有判断<code>hasStrings</code>为<code>YES</code>就去读取，又不能清剪切板，其实还是有点不尽人意，然后又看到这个属性：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@property(readonly, nonatomic) NSInteger changeCount;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">The number of times the pasteboard’s contents have changed.</span><br><span class="line"></span><br><span class="line">Whenever the contents of a pasteboard changes—specifically, when pasteboard items are added, modified, or removed—UIPasteboard increments the value of this property. After it increments the change count, UIPasteboard posts the notifications named UIPasteboardChangedNotification (for additions and modifications) and UIPasteboardRemovedNotification (for removals). These notifications include (in the userInfo dictionary) the types of the pasteboard items added or removed. Because UIPasteboard waits until the end of the current event loop before incrementing the change count, notifications can be batched. The class also updates the change count when an app reactivates and another app has changed the pasteboard contents. When users restart a device, the change count is reset to zero.</span><br></pre></td></tr></table></figure>
<p>然后就又加了一个条件，记录一下真正读取剪切板时的<code>changeCount</code>，如果下次读取的时候没有发生变化则不读取。<br>这样一来效果就好多了，应用运行生命周期内，基本上只会弹出一次提示。</p>
<p>但是，后来看到淘宝更牛逼，命中了真正分享出来的内容才会弹，其他则不会弹。然后就研究了一下淘宝的分享内容和新的API文档，大概得到了答案。<br>先看下淘宝的分享内容：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">9👈幅治内容 Http:&#x2F;T$AJg8c4IfW3q$打開👉绹..寶👈【贵州茅台酒 茅台 飞天53度酱香型白酒收藏 500ml*1单瓶装送礼高度】</span><br></pre></td></tr></table></figure>
<p>组成部分：数字+文字+链接的形势，再结合iOS 14提供的新API：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">detectPatternsForPatterns:completionHandler:</span><br><span class="line">detectPatternsForPatterns:inItemSet:completionHandler:</span><br></pre></td></tr></table></figure>

<p>而<code>UIPasteboardDetectionPattern</code>系统只提供了三种：</p>
<ol>
<li>数字 <code>UIPasteboardDetectionPatternNumber</code></li>
<li>链接 <code>UIPasteboardDetectionPatternProbableWebURL</code></li>
<li>搜索<code>UIPasteboardDetectionPatternProbableWebSearch</code></li>
</ol>
<p>大胆猜测，淘宝应该是通过判断是否符合数字和链接的规则来判断是否命中分享内容。</p>
<p>然后就写了一个demo来验证，核心代码如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">UIPasteboard *board &#x3D; [UIPasteboard generalPasteboard];</span><br><span class="line">    </span><br><span class="line">[board detectPatternsForPatterns:[NSSet setWithObjects:UIPasteboardDetectionPatternProbableWebURL, UIPasteboardDetectionPatternNumber, UIPasteboardDetectionPatternProbableWebSearch, nil]</span><br><span class="line">                   completionHandler:^(NSSet&lt;UIPasteboardDetectionPattern&gt; * _Nullable set, NSError * _Nullable error) &#123;</span><br><span class="line">        </span><br><span class="line">        BOOL hasNumber &#x3D; NO, hasURL &#x3D; NO;</span><br><span class="line">        for (NSString *type in set) &#123;</span><br><span class="line">            if ([type isEqualToString:UIPasteboardDetectionPatternProbableWebURL]) &#123;</span><br><span class="line">                hasURL &#x3D; YES;</span><br><span class="line">            &#125; else if ([type isEqualToString:UIPasteboardDetectionPatternNumber]) &#123;</span><br><span class="line">                hasNumber &#x3D; YES;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        if (hasNumber &amp;&amp; hasURL) &#123;</span><br><span class="line">            </span><br><span class="line">            dispatch_async(dispatch_get_main_queue(), ^&#123;</span><br><span class="line">                UIAlertController *alert &#x3D; [UIAlertController alertControllerWithTitle:@&quot;温馨提示&quot; message:[NSString stringWithFormat:@&quot;%@\n%@&quot;, [board string], @&quot;符合淘宝的读取标准&quot;] preferredStyle:UIAlertControllerStyleAlert];</span><br><span class="line">                UIAlertAction *cancelAction &#x3D; [UIAlertAction actionWithTitle:@&quot;确定&quot; style:UIAlertActionStyleCancel handler:nil];</span><br><span class="line">                [alert addAction:cancelAction];</span><br><span class="line">                [self presentViewController:alert animated:YES completion:nil];</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;];</span><br></pre></td></tr></table></figure>

<p>然后构造了一个看起来符合条件<code>1 http:/123abc</code>的串去反向验证了一下发现demo和淘宝的结果的表现是一致的，都弹了系统提示。</p>
<p>具体的demo可去<a href="https://github.com/y500/ios14_uipasteboard" target="_blank" rel="noopener">github</a>下载。</p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2020/09/25/flutter-xcode12-ios14-crash/">iOS14 debug安装的带有flutter应用从桌面图标重新启动时闪退</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2020-09-25</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/Objective-C/">Objective-C</a></span><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/iOS/">iOS</a></span><div class="content"><p>刚刚升级遇到的问题，希望能够帮助到遇到相同问题的人。</p>
<ol>
<li>用xcode12连接iOS设备调试安装应用</li>
<li>拔掉数据线</li>
<li>从桌面图标点击进入App必闪退</li>
</ol>
<p>后来发现是flutter的原因，目前有下面两种个解决方案：</p>
<ol>
<li>使用flutter的release模式 <code>flutter run --release</code></li>
<li>使用flutter的beta版本v1.22</li>
</ol>
<p>参考文章：</p>
<ol>
<li><a href="https://medium.com/flutter/supporting-ios-14-and-xcode-12-with-flutter-15fe0062e98b" target="_blank" rel="noopener">https://medium.com/flutter/supporting-ios-14-and-xcode-12-with-flutter-15fe0062e98b</a></li>
<li><a href="https://github.com/flutter/flutter/issues/66175" target="_blank" rel="noopener">https://github.com/flutter/flutter/issues/66175</a></li>
</ol>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2020/06/29/JavaScript-Depth-of-Tree/">用JavaScript实现树的前序、中序、后续查询以及高度计算</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2020-06-29</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/Javascript/">Javascript</a></span><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/tree/">tree</a><span class="article-meta__link">-</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/data-structure/">data structure</a></span><div class="content"><p>用JavaScript实现树的前序、中序、后续查询以及高度计算</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TreeNode</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span> (value) &#123;</span><br><span class="line">        <span class="keyword">this</span>.value = value;</span><br><span class="line">        <span class="keyword">this</span>.left = <span class="keyword">this</span>.right = <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> maxDepth = <span class="function"><span class="keyword">function</span>(<span class="params">troot</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!troot) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> left = maxDepth(troot.left);</span><br><span class="line">    <span class="keyword">const</span> right = maxDepth(troot.right);</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Math</span>.max(left, right) + <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> preOrder = <span class="function"><span class="keyword">function</span>(<span class="params">root</span>) </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (!root) &#123;</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">console</span>.log(root.value);</span><br><span class="line">	preOrder(root.left);</span><br><span class="line">	preOrder(root.right);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> preOrderWithoutRescursion = <span class="function"><span class="keyword">function</span>(<span class="params">root</span>) </span>&#123;</span><br><span class="line">	<span class="keyword">let</span> stack = [];</span><br><span class="line">	<span class="keyword">let</span> pointNode = root;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">while</span>(pointNode || stack.length &gt; <span class="number">0</span>) &#123;</span><br><span class="line">		<span class="keyword">while</span>(pointNode) &#123;</span><br><span class="line">			<span class="built_in">console</span>.log(pointNode.value);</span><br><span class="line">			stack.push(pointNode);</span><br><span class="line">			pointNode = pointNode.left;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> (stack.length &gt; <span class="number">0</span>) &#123;</span><br><span class="line">			pointNode = stack.pop();</span><br><span class="line">			pointNode = pointNode.right;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> midOrder = <span class="function"><span class="keyword">function</span>(<span class="params">root</span>) </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (!root) &#123;</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	midOrder(root.left);</span><br><span class="line">	<span class="built_in">console</span>.log(root.value);</span><br><span class="line">	midOrder(root.right);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> midOrderWithoutRescursion = <span class="function"><span class="keyword">function</span>(<span class="params">root</span>) </span>&#123;</span><br><span class="line">	<span class="keyword">let</span> stack = [];</span><br><span class="line">	<span class="keyword">let</span> pointNode = root;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">while</span>(pointNode || stack.length &gt; <span class="number">0</span>) &#123;</span><br><span class="line">		<span class="keyword">while</span>(pointNode) &#123;</span><br><span class="line">			stack.push(pointNode);</span><br><span class="line">			pointNode = pointNode.left;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> (stack.length &gt; <span class="number">0</span>) &#123;</span><br><span class="line">			pointNode = stack.pop();</span><br><span class="line">			<span class="built_in">console</span>.log(pointNode.value);</span><br><span class="line">			pointNode = pointNode.right;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> postOrder = <span class="function"><span class="keyword">function</span>(<span class="params">root</span>) </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (!root) &#123;</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	postOrder(root.left);</span><br><span class="line">	postOrder(root.right);</span><br><span class="line">	<span class="built_in">console</span>.log(root.value);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> postOrderWithoutRescursion = <span class="function"><span class="keyword">function</span>(<span class="params">root</span>) </span>&#123;</span><br><span class="line">	<span class="keyword">let</span> stack = [];</span><br><span class="line">	<span class="keyword">let</span> pointNode = root;</span><br><span class="line">	<span class="keyword">let</span> right = root;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">while</span>(pointNode || stack.length &gt; <span class="number">0</span>) &#123;</span><br><span class="line">		<span class="keyword">if</span> (pointNode) &#123;</span><br><span class="line">			stack.push(pointNode);</span><br><span class="line">			pointNode = pointNode.left;</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			pointNode = stack.length &gt; <span class="number">0</span> ? stack[stack.length - <span class="number">1</span>] : <span class="literal">null</span>;</span><br><span class="line">			<span class="keyword">if</span> (pointNode.right &amp;&amp; pointNode.right != right) &#123;</span><br><span class="line">				pointNode = pointNode.right;</span><br><span class="line">			&#125; <span class="keyword">else</span>&#123;</span><br><span class="line">				pointNode = stack.pop();</span><br><span class="line">				<span class="built_in">console</span>.log(pointNode.value);</span><br><span class="line">				right = pointNode;</span><br><span class="line">				pointNode = <span class="literal">null</span>;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> levelOrder = <span class="function"><span class="keyword">function</span>(<span class="params">root</span>) </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (!root) &#123;</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">let</span> queue = [];</span><br><span class="line">	queue.unshift(root);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">while</span>(queue.length &gt; <span class="number">0</span>) &#123;</span><br><span class="line">		<span class="keyword">let</span> pointNode = queue.pop();</span><br><span class="line">		<span class="built_in">console</span>.log(pointNode.value);</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> (pointNode.left) &#123;</span><br><span class="line">			queue.unshift(pointNode.left)</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> (pointNode.right) &#123;</span><br><span class="line">			queue.unshift(pointNode.right);</span><br><span class="line">		&#125;		</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> tree = <span class="keyword">new</span> TreeNode(<span class="number">3</span>);</span><br><span class="line">tree.left = <span class="keyword">new</span> TreeNode(<span class="number">9</span>);</span><br><span class="line">tree.right = <span class="keyword">new</span> TreeNode(<span class="number">20</span>);</span><br><span class="line">tree.right.left = <span class="keyword">new</span> TreeNode(<span class="number">15</span>);</span><br><span class="line">tree.right.right = <span class="keyword">new</span> TreeNode(<span class="number">7</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> depth = maxDepth(tree);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"depth:"</span>+depth);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"pre order:"</span>);</span><br><span class="line">preOrder(tree);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"mid order:"</span>);</span><br><span class="line">midOrder(tree)</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"post order:"</span>);</span><br><span class="line">postOrder(tree)</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"pre order without recursion"</span>);</span><br><span class="line">preOrderWithoutRescursion(tree);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"mid order without recursion"</span>);</span><br><span class="line">midOrderWithoutRescursion(tree);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"post order without recursion"</span>);</span><br><span class="line">postOrderWithoutRescursion(tree);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"level order"</span>);</span><br><span class="line">levelOrder(tree);</span><br></pre></td></tr></table></figure>

<p>运行结果：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">depth:3</span><br><span class="line">pre order:</span><br><span class="line">3</span><br><span class="line">9</span><br><span class="line">20</span><br><span class="line">15</span><br><span class="line">7</span><br><span class="line">mid order:</span><br><span class="line">9</span><br><span class="line">3</span><br><span class="line">15</span><br><span class="line">20</span><br><span class="line">7</span><br><span class="line">post order:</span><br><span class="line">9</span><br><span class="line">15</span><br><span class="line">7</span><br><span class="line">20</span><br><span class="line">3</span><br><span class="line">pre order without recursion</span><br><span class="line">3</span><br><span class="line">9</span><br><span class="line">20</span><br><span class="line">15</span><br><span class="line">7</span><br><span class="line">mid order without recursion</span><br><span class="line">9</span><br><span class="line">3</span><br><span class="line">15</span><br><span class="line">20</span><br><span class="line">7</span><br><span class="line">post order without recursion</span><br><span class="line">9</span><br><span class="line">15</span><br><span class="line">7</span><br><span class="line">20</span><br><span class="line">3</span><br><span class="line">level order</span><br><span class="line">3</span><br><span class="line">9</span><br><span class="line">20</span><br><span class="line">15</span><br><span class="line">7</span><br></pre></td></tr></table></figure>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2017/11/15/NSObject/">NSObject中类方法load和initialize</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2017-11-15</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/Objectve-C/">Objectve-C</a></span><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/iOS/">iOS</a><span class="article-meta__link">-</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/Objective-c/">Objective-c</a><span class="article-meta__link">-</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/load/">load</a><span class="article-meta__link">-</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/initialize/">initialize</a></span><div class="content"><p>+load和+initialize是NSObject的两个类方法，这两个类方法会在类被使用时主动调用，但是调用时机和调用顺序却截然不同。</p>
<p>先看看苹果的<a href="https://developer.apple.com/documentation/objectivec/nsobject#//apple_ref/occ/cl/NSObject" target="_blank" rel="noopener">官方文档里面</a>：</p>
<h3 id="Initialize"><a href="#Initialize" class="headerlink" title="Initialize"></a>Initialize</h3><blockquote>
<p>###Initializing a Class<br>class func initialize()<br>Initializes the class before it receives its first message.</p>
</blockquote>
<blockquote>
<p>he runtime sends initialize() to each class in a program just before the class, or any class that inherits from it, is sent its first message from within the program. Superclasses receive this message before their subclasses.<br>The runtime sends the initialize() message to classes in a thread-safe manner. That is, initialize() is run by the first thread to send a message to a class, and any other thread that tries to send a message to that class will block until initialize() completes.<br>The superclass implementation may be called multiple times if subclasses do not implement initialize()—the runtime will call the inherited implementation—or if subclasses explicitly call [super initialize]. If you want to protect yourself from being run multiple times, you can structure your implementation along these lines:</p>
</blockquote>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">+ (<span class="keyword">void</span>)initialize &#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">self</span> == [ClassName <span class="keyword">self</span>]) &#123;</span><br><span class="line">    <span class="comment">// ... do the initialization ...</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Because initialize() is called in a blocking manner, it’s important to limit method implementations to the minimum amount of work necessary possible. Specifically, any code that takes locks that might be required by other classes in their initialize() methods is liable to lead to deadlocks. Therefore, you should not rely on initialize() for complex initialization, and should instead limit it to straightforward, class local initialization.</p>
</blockquote>
<blockquote>
<p>initialize() is invoked only once per class. If you want to perform independent initialization for the class and for categories of the class, you should implement load() methods.</p>
</blockquote>
<ol>
<li><code>initialize</code>方法是在该类接收到第一个消息之前调用.</li>
<li>父类的 <code>initialize</code> 方法先于子类的 <code>initialize</code> 方法调用.</li>
<li>如果子类中没有实现 <code>initialize</code> 方法，或者子类显示调用父类实现 [super initialize], 那么则会调用其父类的实现。也就是说，父类的 <code>initialize</code> 可能会被调用多次。</li>
<li>在应用程序生命周期里，<code>runtime</code> 只会向每个类发送一次 <code>initialize</code> 消息. 所以如果category中实现了<code>initialize</code>方法，那么原来类中的则不会被调用.</li>
</ol>
<p>看下面的例子：</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">SuperObject</span> : <span class="title">NSObject</span></span></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">SuperObject</span></span></span><br><span class="line">+ (<span class="keyword">void</span>)initialize &#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"%s"</span>, __FUNCTION__);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">SubObject</span> : <span class="title">SuperObject</span></span></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">SubObject</span></span></span><br><span class="line">+ (<span class="keyword">void</span>)initialize &#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"%s"</span>, __FUNCTION__);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> main(<span class="keyword">int</span> argc, <span class="keyword">char</span> * argv[]) &#123;</span><br><span class="line">    <span class="keyword">@autoreleasepool</span> &#123;</span><br><span class="line">        [SubObject <span class="keyword">class</span>];</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">UIApplicationMain</span>(argc, argv, <span class="literal">nil</span>, <span class="built_in">NSStringFromClass</span>([AppDelegate <span class="keyword">class</span>]));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>输出：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">+[SuperObject initialize]</span><br><span class="line">+[SubObject initialize]</span><br></pre></td></tr></table></figure>

<p>就算把main函数中的<code>[SubObject class]</code>改为：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[SubObject class];</span><br><span class="line">[[SubObject alloc] init];</span><br></pre></td></tr></table></figure>
<p>输出还是一样。</p>
<p>添加一个category：</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">SubObject</span> (<span class="title">category</span>)</span></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">SubObject</span> (<span class="title">category</span>)</span></span><br><span class="line">+ (<span class="keyword">void</span>)initialize &#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"%s"</span>, __FUNCTION__);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>

<p>输出则为（category中方法覆盖了原类中的方法）：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">+[SuperObject initialize]</span><br><span class="line">+[SubObject(category) initialize]</span><br></pre></td></tr></table></figure>

<h3 id="load"><a href="#load" class="headerlink" title="load"></a>load</h3><blockquote>
<p>###class func load()<br>Invoked whenever a class or category is added to the Objective-C runtime; implement this method to perform class-specific behavior upon loading.</p>
</blockquote>
<blockquote>
<p>The load() message is sent to classes and categories that are both dynamically loaded and statically linked, but only if the newly loaded class or category implements a method that can respond.<br>The order of initialization is as follows:</p>
</blockquote>
<pre><code>1. All initializers in any framework you link to.
2. All +load methods in your image.
3. All C++ static initializers and C/C++ __attribute__(constructor) functions in your image.
4. All initializers in frameworks that link to you.</code></pre><blockquote>
<p>In addition:</p>
</blockquote>
<pre><code>* A class’s +load method is called after all of its superclasses’ +load methods.
* A category +load method is called after the class’s own +load method.</code></pre><blockquote>
<p>In a custom implementation of load() you can therefore safely message other unrelated classes from the same image, but any load() methods implemented by those classes may not have run yet.</p>
</blockquote>
<ol>
<li>在类或者category被添加到runtime的时候调用，该调用发生在main函数之前。</li>
<li>父类<code>load</code>方法先于子类调用，类本身<code>load</code>方法先于category中调用。</li>
</ol>
<p>看下面的例子：</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">SuperObject</span> : <span class="title">NSObject</span></span></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">SuperObject</span></span></span><br><span class="line">+ (<span class="keyword">void</span>)initialize &#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"%@ , %s"</span>, [<span class="keyword">self</span> <span class="keyword">class</span>], __FUNCTION__);</span><br><span class="line">&#125;</span><br><span class="line">+ (<span class="keyword">void</span>)load &#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"%@, %s"</span>, [<span class="keyword">self</span> <span class="keyword">class</span>], __FUNCTION__);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">SubObject</span> : <span class="title">SuperObject</span></span></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">SubObject</span></span></span><br><span class="line">+ (<span class="keyword">void</span>)initialize &#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"%@, %s"</span>, [<span class="keyword">self</span> <span class="keyword">class</span>], __FUNCTION__);</span><br><span class="line">&#125;</span><br><span class="line">+ (<span class="keyword">void</span>)load &#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"%@, %s"</span>, [<span class="keyword">self</span> <span class="keyword">class</span>], __FUNCTION__);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">SubObject</span> (<span class="title">category</span>)</span></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">SubObject</span> (<span class="title">category</span>)</span></span><br><span class="line">+ (<span class="keyword">void</span>)initialize &#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"%@, %s"</span>, [<span class="keyword">self</span> <span class="keyword">class</span>], __FUNCTION__);</span><br><span class="line">&#125;</span><br><span class="line">+ (<span class="keyword">void</span>)load &#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"%@ %s"</span>, [<span class="keyword">self</span> <span class="keyword">class</span>], __FUNCTION__);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> main(<span class="keyword">int</span> argc, <span class="keyword">char</span> * argv[]) &#123;</span><br><span class="line">    <span class="keyword">@autoreleasepool</span> &#123;</span><br><span class="line">        SubObject *subObject = [[SubObject alloc] init];</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">UIApplicationMain</span>(argc, argv, <span class="literal">nil</span>, <span class="built_in">NSStringFromClass</span>([AppDelegate <span class="keyword">class</span>]));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>输出结果（这里有点地方要解释一下，按照文档的说法，<code>load</code>应该咋<code>initialize</code>之前，这里实在之后，原是因为，<code>load</code>方法中调用了<code>class</code>方法，从而触发了<code>initialize</code>方法，所以出现了这种情况）：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">SuperObject , +[SuperObject initialize]</span><br><span class="line">SuperObject, +[SuperObject load]</span><br><span class="line">SubObject, +[SubObject(category) initialize]</span><br><span class="line">SubObject, +[SubObject load]</span><br><span class="line">SubObject +[SubObject(category) load]</span><br></pre></td></tr></table></figure>

<p>再看一个例子，子类中不实现<code>initialize</code>方法：</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">SuperObject</span> : <span class="title">NSObject</span></span></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">SuperObject</span></span></span><br><span class="line">+ (<span class="keyword">void</span>)initialize &#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"%@ , %s"</span>, [<span class="keyword">self</span> <span class="keyword">class</span>], __FUNCTION__);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">SubObject</span> : <span class="title">SuperObject</span></span></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">SubObject</span></span></span><br><span class="line">+ (<span class="keyword">void</span>)load &#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"%@, %s"</span>, [<span class="keyword">self</span> <span class="keyword">class</span>], __FUNCTION__);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> main(<span class="keyword">int</span> argc, <span class="keyword">char</span> * argv[]) &#123;</span><br><span class="line">    <span class="keyword">@autoreleasepool</span> &#123;</span><br><span class="line">        SubObject *subObject = [[SubObject alloc] init];</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">UIApplicationMain</span>(argc, argv, <span class="literal">nil</span>, <span class="built_in">NSStringFromClass</span>([AppDelegate <span class="keyword">class</span>]));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>输出结果如下（子类自动调了父类的<code>initialize</code>）：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SuperObject , +[SuperObject initialize]</span><br><span class="line">SubObject , +[SuperObject initialize]</span><br><span class="line">SubObject, +[SubObject load]</span><br></pre></td></tr></table></figure>

<p><strong>不需要在<code>load</code>和<code>initialize</code>方法中显式的去调用父类的方法。</strong></p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2017/04/13/Alloc-init/">Object-C Two-Stage Creation：alloc、init</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2017-04-13</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/Objective-C/">Objective-C</a></span><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/iOS/">iOS</a></span><div class="content"><p>在其他语种中例如JAVA，C++，Ruby等这些语言中<code>new</code>是很常见的，但是在object-c中，大家最常见到的和最常用的初始化方法就是<code>[[ClassName alloc] init]</code>而不是<code>[ClassName new]</code> 去初始化对象。</p>
<p>先来看看他们的方法实现：</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">+ new &#123;</span><br><span class="line">    <span class="keyword">id</span> newObject = (*_alloc)((Class)<span class="keyword">self</span>, <span class="number">0</span>);</span><br><span class="line">    Class metaClass = <span class="keyword">self</span>-&gt;isa;</span><br><span class="line">    <span class="keyword">if</span> (class_getVersion(metaClass) &gt; <span class="number">1</span>)</span><br><span class="line">        <span class="keyword">return</span> [newObject init];</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="keyword">return</span> newObject;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">+ alloc &#123;</span><br><span class="line">    <span class="keyword">return</span> (*_zoneAlloc)((Class)<span class="keyword">self</span>, <span class="number">0</span>, malloc_default_zone());  </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- init &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>从上面的实现方法来看，其实就是把<code>new</code>拆分成了<code>alloc</code>和<code>init</code>，所以在Cocoa的文档中，这种创建对象的方法也被叫做 <code>Two-Stage Creation</code></p>
<p>首先我们看看Cocoa这么设计的初衷是什么</p>
<ul>
<li>使用初始化方法的时候，不需要管内存分配的方式</li>
<li>子类化一个对象时，避免需要实现太多的初始化方法</li>
<li>简化临时实例的创建和使用</li>
</ul>
<p>怎么理解呢，举个例子：<br>假如有这样一个对象，处于一些特殊原因，有5中分配内存的方式和10种初始化的方式，如果alloc和init在一起的，那么就需要5*10种构造方法为每一种内存分配方式下提供10中初始化方式。如果alloc和init分开的话，就只需要分别提供5种内存分配方式和10中初始化的方式就可以了。</p>
<p>###alloc</p>
<p>NSObject这个基类提供了两种内存分配的方法：<code>+(id)alloc</code> 和 <code>+(id)allocWithZone:(NSZone *)aZone</code>，这两个方法在被继承的对象中几乎从不被重写。<code>+(id)alloc</code> 其实也是调用了 <code>+(id)allocWithZone:(NSZone *)aZone</code> 传入了一个默认的zone参数（等下我们再详细说下zone）。这两个方法会返回一个指向一个重新分配的内存块的指针并且做了下面几件事情：</p>
<ol>
<li>把对象的retain count设为1.</li>
<li>把对象的isa变量指向对象的class</li>
<li>初始化所有的成员变量为默认值（0、nil，0.0 etc.）</li>
</ol>
<p>####Zones</p>
<p>这个从头说起，每一个Cocoa的应用都有大量的可寻址内存。</p>
<p>当设备上所有物理内存都被占用了，这时有应用还在动态的向操作系统申请内存。这个时候，操作系统就会把内存中的一些内容拷到硬盘（swapping）上从而释放出一部分内存来满足这个要求。</p>
<p>然后应用运行的过程中要需要用到拷到硬盘上去的那部分数据了，操作系统又会把内存中另外一块内容拷到硬盘上，然后把之前拷出去的换回来供应用使用。</p>
<p>由于这样的操作是比较耗时的，所以这样操作过多时就会造成抖动（thrashing）。</p>
<p>如果经常一起使用的两个object存在内存中比较“远”的块中，那么造成抖动的机会就会大大的增加。</p>
<p>考虑一下这种情况：</p>
<ol>
<li>应用需要使用到的其中一个object不在内存中，这个时候就需要把硬盘中的块儿换回来。</li>
<li>换回来之后，发现这个object要访问的另外一个object又不在内存中。</li>
<li>这时就需要这时就需要继续从硬盘中换回数据。</li>
<li>最坏的情况就是，换第二部分的时候又把第一次的给换出去了。</li>
</ol>
<p>OK，那么zone就是用来保证需要一起使用的object尽量分配的互相靠近的位置，保证，要么都在内存中，要么都在硬盘中，避免上面的情况发生。</p>
<p>不过在OS X 10.5的Object-C 2.0之后，如果你使用了ARC，那么<code>allocWithZone:</code>的zone参数将被忽略，Apple不在鼓励使用这个方法，这些操作将默认有Cocoa来实现。</p>
<p>###init</p>
<p>当内存分配完成之后，就要调用object的实例方法进行初始化了。这些初始化方法通常以<code>init</code>开头，返回值为<code>id</code>类型。</p>
<ul>
<li>一个对象可以有很多初始化方法，每一个初始化方法可以带不同的参数，通常其中有一个初始化方法会作为为对象的指定初始化方法(The Designated Initializer)。比如NSObject的指定初始化方法是<code>-(id)init</code>，UIView的默认初始化方法是<code>-(id)initWithFrame:(CGRect)frame</code>。</li>
<li>任何一个初始化方法都可以成为指定的初始化方法，但是必须要明确的说明。</li>
<li>一般情况下，指定的初始化方法是那个带参数最多的初始化方法。</li>
<li>其他的初始化方法通过调用指定的初始化方法来实现。</li>
</ul>
<p>看下面的例子：</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">MYCircle</span> : <span class="title">NSObject</span></span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="built_in">NSPoint</span> center;</span><br><span class="line">	<span class="keyword">float</span> radius;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Designated Initializer</span></span><br><span class="line">- (<span class="keyword">id</span>)initWithCenter:(<span class="built_in">NSPoint</span>)aPoint radius:(<span class="keyword">float</span>)aRadius;</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">MYCircle</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Designated Initializer</span></span><br><span class="line">- (<span class="keyword">id</span>)initWithCenter:(<span class="built_in">NSPoint</span>)aPoint radius:(<span class="keyword">float</span>)aRadius</span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">self</span> = [<span class="keyword">super</span> init];</span><br><span class="line">	<span class="keyword">if</span>(<span class="literal">nil</span> != <span class="keyword">self</span>) &#123;</span><br><span class="line">		center = aPoint;</span><br><span class="line">		radius = aRadius;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p>这里的<code>self=[super init]</code>是至关重要的一步。</p>
<ol>
<li><code>[super init]</code>可能会失败，如果失败了，接下来如果继续操作的话是不可预期的。</li>
<li>super可能会重新+alloc然后返回一个跟self完全不同的object，这种情况下接下来的操作也是有问题的。</li>
</ol>
<p>回到刚才的问题，在这个例子中<code>- (id)initWithCenter:(NSPoint)aPoint radius:(float)aRadius;</code>被标记为指定的初始化方法。这种情况下，应该重写继承的父类的指定初始化方法<code>-(id)init</code> (通过<code>NS_DESIGNATED_INITIALIZER</code>标记)</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">id</span>)init</span><br><span class="line"><span class="comment">// Overriden inherited Designated Initializer - (id)init</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">float</span> MYDefaultRadius = <span class="number">1.0</span>f;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// call Designated Initializer with default arguments</span></span><br><span class="line">	<span class="keyword">return</span> [<span class="keyword">self</span> initWithCenter:<span class="built_in">NSZeroPoint</span> radius:MYDefaultRadius];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">id</span>)initWithRadius:(<span class="keyword">float</span>)aRadius</span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">return</span> [<span class="keyword">self</span> initWithCenter:<span class="built_in">NSZeroPoint</span> radius:aRadius];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p>基本上要遵循一下几点：</p>
<ol>
<li>确保指定初始化方法要调用父类的指定初始化方法。</li>
<li>把父类的制定初始化方法的返回值赋给self。</li>
<li>如果父类的指定初始化返回为nil时，不要继续去操作示例变量了。</li>
<li>如果标记了新的指定初始化方法，那么一定要重写所继承的父类的指定初始化方法（例子总的init）。</li>
<li>继承的时候，确保每一个初始化方法，如果本身不是指定初始化方法，那么就要调用指定初始化方法去实现。</li>
</ol>
<p>###Creating Temporary Instances</p>
<p>临时变量的创建就是把alloc和init合并到一起然后返回一个临时的实例对象。</p>
<p>MRC情况下：</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">+ (<span class="keyword">id</span>)stringWithString:(<span class="built_in">NSString</span> *)aString</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">return</span> [[[<span class="keyword">self</span> alloc] initWithString:aString] autorelease];</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ARC情况下：</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">+ (<span class="keyword">id</span>)stringWithString:(<span class="built_in">NSString</span> *)aString</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">return</span> [[<span class="keyword">self</span> alloc] initWithString:aString];</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这样在创建和使用临时实例的时候就非常方便了。</p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2016/10/21/add-infomation-on-app-icon/">【译】在应用的icon上加上编译相关信息</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2016-10-21</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/Objective-C/">Objective-C</a></span><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/iOS/">iOS</a></span><div class="content"><p>#####加那些信息</p>
<ul>
<li>版本号</li>
<li>代码分支名字</li>
<li>最后一次commit的hash值</li>
</ul>
<p>######版本号<br>我们可以使用PlistBuddy工具直接从项目文件info.plist中取出版本号</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">version&#x3D;&#96;&#x2F;usr&#x2F;libexec&#x2F;PlistBuddy -c &quot;Print CFBundleVersion&quot; &quot;$&#123;INFOPLIST_FILE&#125;&quot;&#96;</span><br></pre></td></tr></table></figure>
<p>(当然了，你可以通过这个工具取出info.plist中的任何值，把CFBundleVersion改为其他的key就行了，key值可以在xcode中查看)</p>
<p>######代码分支名字和commit的hash值<br>这两个值我们可以通过git的命令行<code>git rev-parse</code>来获取</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">commit&#x3D;&#96;git rev-parse --short HEAD&#96;</span><br><span class="line">branch&#x3D;&#96;git rev-parse --abbrev-ref HEAD&#96;</span><br></pre></td></tr></table></figure>

<p>######怎么把这些信息放到icon上去？<br>ImageMagic是一个操作图片的命令行工具，这个工具有一堆牛逼的功能</p>
<p>首先要安装ImageMagick和ghostscript（fonts）工具，可以使用brew来快速安装</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">brew install imagemagick</span><br><span class="line">brew install ghostscript</span><br></pre></td></tr></table></figure>
<p>我们可以使用convert工具，通过配置imagemagic的caption参数把这些文字信息放到icon上，顺便设置底部对齐以及默认高度。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">convert -background &#39;#0008&#39; -fill white -gravity center -size $&#123;width&#125;x40 \</span><br><span class="line">    caption:&quot;$&#123;version&#125; $&#123;branch&#125; $&#123;commit&#125;&quot; \</span><br><span class="line">    $&#123;base_file&#125; +swap -gravity south -composite  &quot;$&#123;CONFIGURATION_BUILD_DIR&#125;&#x2F;$&#123;UNLOCALIZED_RESOURCES_FOLDER_PATH&#125;&#x2F;$&#123;target_file&#125;&quot;</span><br></pre></td></tr></table></figure>
<p>#####xcode 项目的配置<br>通过几部简单的配置把这些步骤加到xcode编译中</p>
<ol>
<li>把项目中的Icon的文件名Icon<em>改为Icon_base</em>(Icon@2x.png to <a href="mailto:Icon@2x_base.png">Icon@2x_base.png</a>)</li>
<li>在编译目标的build phase中添加下面的脚本：<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">commit&#x3D;&#96;git rev-parse --short HEAD&#96;</span><br><span class="line">branch&#x3D;&#96;git rev-parse --abbrev-ref HEAD&#96;</span><br><span class="line">version&#x3D;&#96;&#x2F;usr&#x2F;libexec&#x2F;PlistBuddy -c &quot;Print CFBundleVersion&quot; &quot;$&#123;INFOPLIST_FILE&#125;&quot;&#96;</span><br><span class="line"></span><br><span class="line">function processIcon() &#123;</span><br><span class="line">    export PATH&#x3D;$PATH:&#x2F;usr&#x2F;local&#x2F;bin</span><br><span class="line">    base_file&#x3D;$1</span><br><span class="line">    base_path&#x3D;&#96;find $&#123;SRCROOT&#125; -name $base_file&#96;</span><br><span class="line"></span><br><span class="line">    if [[ ! -f $&#123;base_path&#125; || -z $&#123;base_path&#125; ]]; then</span><br><span class="line">        return;</span><br><span class="line">    fi</span><br><span class="line"></span><br><span class="line">    target_file&#x3D;&#96;echo $base_file | sed &quot;s&#x2F;_base&#x2F;&#x2F;&quot;&#96;</span><br><span class="line">    target_path&#x3D;&quot;$&#123;CONFIGURATION_BUILD_DIR&#125;&#x2F;$&#123;UNLOCALIZED_RESOURCES_FOLDER_PATH&#125;&#x2F;$&#123;target_file&#125;&quot;</span><br><span class="line"></span><br><span class="line">    if [ $CONFIGURATION &#x3D; &quot;Release&quot; ]; then</span><br><span class="line">    cp $&#123;base_file&#125; $target_path</span><br><span class="line">    return</span><br><span class="line">    fi</span><br><span class="line"></span><br><span class="line">    width&#x3D;&#96;identify -format %w $&#123;base_path&#125;&#96;</span><br><span class="line"></span><br><span class="line">    convert -background &#39;#0008&#39; -fill white -gravity center -size $&#123;width&#125;x40\</span><br><span class="line">    caption:&quot;$&#123;version&#125; $&#123;branch&#125; $&#123;commit&#125;&quot;\</span><br><span class="line">    $&#123;base_path&#125; +swap -gravity south -composite $&#123;target_path&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">processIcon &quot;Icon_base.png&quot;</span><br><span class="line">processIcon &quot;Icon@2x_base.png&quot;</span><br><span class="line">processIcon &quot;Icon-72_base.png&quot;</span><br><span class="line">processIcon &quot;Icon-72@2x_base.png&quot;</span><br></pre></td></tr></table></figure>

</li>
</ol>
<p>#####结尾</p>
<p>关于这个脚本的几个小点：</p>
<ol>
<li>自动跳过不存在的icon文件</li>
<li>通过sed去掉文件名末尾的_base字符串</li>
<li>release版本则不会添加这些信息到icon上</li>
<li>xcode貌似吧path信息弄乱了，所以在这个脚本使用中添加了<code>usr/local/bin</code>路径</li>
</ol>
<p><a href="https://github.com/krzysztofzablocki/IconOverlaying" target="_blank" rel="noopener">脚本和例子看这里</a></p>
<p>原文地址：<a href="http://merowing.info/2013/03/overlaying-application-version-on-top-of-your-icon/" target="_blank" rel="noopener">http://merowing.info/2013/03/overlaying-application-version-on-top-of-your-icon/</a></p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2015/12/30/ffmpeg-commands/">ffmpeg常用基本命令[整理]</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2015-12-30</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/ffmpeg/">ffmpeg</a></span><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/ffmpeg/">ffmpeg</a></span><div class="content"><p>主要参数： -i 设定输入流 -f 设定输出格式 -ss 开始时间 视频参数： -b 设定视频流量，默认为200Kbit/s -r 设定帧速率，默认为25 -s 设定画面的宽与高 -aspect 设定画面的比例 -vn 不处理视频 -vcodec 设定视频编解码器，未设定时则使用与输入流相同的编解码器 音频参数： -ar 设定采样率 -ac 设定声音的Channel数 -acodec 设定声音编解码器，未设定时则使用与输入流相同的编解码器 -an 不处理音频</p>
<p>1.分离视频音频流</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ffmpeg -i input_file -vcodec copy -an output_file_video　　&#x2F;&#x2F;分离视频流</span><br><span class="line">ffmpeg -i input_file -acodec copy -vn output_file_audio　　&#x2F;&#x2F;分离音频流</span><br></pre></td></tr></table></figure>
<p>2.视频解复用</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ffmpeg –i test.mp4 –vcodec copy –an –f m4v test.264</span><br><span class="line">ffmpeg –i test.avi –vcodec copy –an –f m4v test.264</span><br></pre></td></tr></table></figure>
<p>3.视频转码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ffmpeg –i test.mp4 –vcodec h264 –s 352*278 –an –f m4v test.264              &#x2F;&#x2F;转码为码流原始文件</span><br><span class="line">ffmpeg –i test.mp4 –vcodec h264 –bf 0 –g 25 –s 352*278 –an –f m4v test.264  &#x2F;&#x2F;转码为码流原始文件</span><br><span class="line">ffmpeg –i test.avi -vcodec mpeg4 –vtag xvid –qsame test_xvid.avi            &#x2F;&#x2F;转码为封装文件</span><br><span class="line">&#x2F;&#x2F;-bf B帧数目控制，-g 关键帧间隔控制，-s 分辨率控制</span><br></pre></td></tr></table></figure>
<p>4.视频封装</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ffmpeg –i video_file –i audio_file –vcodec copy –acodec copy output_file</span><br></pre></td></tr></table></figure>
<p>5.视频剪切</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ffmpeg –i test.avi –r 1 –f image2 image-%3d.jpeg        &#x2F;&#x2F;提取图片</span><br><span class="line">ffmpeg -ss 0:1:30 -t 0:0:20 -i input.avi -vcodec copy -acodec copy output.avi    &#x2F;&#x2F;剪切视频</span><br><span class="line">&#x2F;&#x2F;-r 提取图像的频率，-ss 开始时间，-t 持续时间</span><br></pre></td></tr></table></figure>
<p>6.视频录制</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ffmpeg –i rtsp:&#x2F;&#x2F;192.168.3.205:5555&#x2F;test –vcodec copy out.avi</span><br></pre></td></tr></table></figure>
<p>7.YUV序列播放</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ffplay -f rawvideo -video_size 1920x1080 input.yuv</span><br></pre></td></tr></table></figure>
<p>8.YUV序列转AVI</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ffmpeg –s w*h –pix_fmt yuv420p –i input.yuv –vcodec mpeg4 output.avi</span><br></pre></td></tr></table></figure>

<p><strong>流媒体相关应用:</strong></p>
<p>1、将文件当做直播送至live</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ffmpeg -re -i localFile.mp4 -c copy -f flv rtmp:&#x2F;&#x2F;server&#x2F;live&#x2F;streamName</span><br></pre></td></tr></table></figure>
<p>2、将直播媒体保存至本地文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ffmpeg -i rtmp:&#x2F;&#x2F;server&#x2F;live&#x2F;streamName -c copy dump.flv</span><br></pre></td></tr></table></figure>
<p>3、将其中一个直播流，视频改用h264压缩，音频不变，送至另外一个直播服务流</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ffmpeg -i rtmp:&#x2F;&#x2F;server&#x2F;live&#x2F;originalStream -c:a copy -c:v libx264 -vpre slow -f flv rtmp:&#x2F;&#x2F;server&#x2F;live&#x2F;h264Stream</span><br></pre></td></tr></table></figure>
<p>4、将其中一个直播流，视频改用h264压缩，音频改用faac压缩，送至另外一个直播服务流</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ffmpeg -i rtmp:&#x2F;&#x2F;server&#x2F;live&#x2F;originalStream -c:a libfaac -ar 44100 -ab 48k -c:v libx264 -vpre slow -vpre baseline -f flv rtmp:&#x2F;&#x2F;server&#x2F;live&#x2F;h264Stream</span><br></pre></td></tr></table></figure>
<p>5、将其中一个直播流，视频不变，音频改用faac压缩，送至另外一个直播服务流</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ffmpeg -i rtmp:&#x2F;&#x2F;server&#x2F;live&#x2F;originalStream -acodec libfaac -ar 44100 -ab 48k -vcodec copy -f flv rtmp:&#x2F;&#x2F;server&#x2F;live&#x2F;h264_AAC_Stream</span><br></pre></td></tr></table></figure>
<p>6、将一个高清流，复制为几个不同视频清晰度的流重新发布，其中音频不变</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ffmpeg -re -i rtmp:&#x2F;&#x2F;server&#x2F;live&#x2F;high_FMLE_stream -acodec copy -vcodec x264lib -s 640×360 -b 500k -vpre medium -vpre baseline rtmp:&#x2F;&#x2F;server&#x2F;live&#x2F;baseline_500k -acodec copy -vcodec x264lib -s 480×272 -b 300k -vpre medium -vpre baseline rtmp:&#x2F;&#x2F;server&#x2F;live&#x2F;baseline_300k -acodec copy -vcodec x264lib -s 320×200 -b 150k -vpre medium -vpre baseline rtmp:&#x2F;&#x2F;server&#x2F;live&#x2F;baseline_150k -acodec libfaac -vn -ab 48k rtmp:&#x2F;&#x2F;server&#x2F;live&#x2F;audio_only_AAC_48k</span><br></pre></td></tr></table></figure>
<p>7、功能一样，只是采用-x264opts选项</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ffmpeg -re -i rtmp:&#x2F;&#x2F;server&#x2F;live&#x2F;high_FMLE_stream -c:a copy -c:v x264lib -s 640×360 -x264opts bitrate&#x3D;500:profile&#x3D;baseline:preset&#x3D;slow rtmp:&#x2F;&#x2F;server&#x2F;live&#x2F;baseline_500k -c:a copy -c:v x264lib -s 480×272 -x264opts bitrate&#x3D;300:profile&#x3D;baseline:preset&#x3D;slow rtmp:&#x2F;&#x2F;server&#x2F;live&#x2F;baseline_300k -c:a copy -c:v x264lib -s 320×200 -x264opts bitrate&#x3D;150:profile&#x3D;baseline:preset&#x3D;slow rtmp:&#x2F;&#x2F;server&#x2F;live&#x2F;baseline_150k -c:a libfaac -vn -b:a 48k rtmp:&#x2F;&#x2F;server&#x2F;live&#x2F;audio_only_AAC_48k</span><br></pre></td></tr></table></figure>
<p>8、将当前摄像头及音频通过DSSHOW采集，视频h264、音频faac压缩后发布</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ffmpeg -r 25 -f dshow -s 640×480 -i video&#x3D;”video source name”:audio&#x3D;”audio source name” -vcodec libx264 -b 600k -vpre slow -acodec libfaac -ab 128k -f flv rtmp:&#x2F;&#x2F;server&#x2F;application&#x2F;stream_name</span><br></pre></td></tr></table></figure>
<p>9、将一个JPG图片经过h264压缩循环输出为mp4视频</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ffmpeg -i INPUT.jpg -an -vcodec libx264 -coder 1 -flags +loop -cmp +chroma -subq 10 -qcomp 0.6 -qmin 10 -qmax 51 -qdiff 4 -flags2 +dct8x8 -trellis 2 -partitions +parti8x8+parti4x4 -crf 24 -threads 0 -r 25 -g 25 -y OUTPUT.mp4</span><br></pre></td></tr></table></figure>
<p>10、将普通流视频改用h264压缩，音频不变，送至高清流服务(新版本FMS live=1)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ffmpeg -i rtmp:&#x2F;&#x2F;server&#x2F;live&#x2F;originalStream -c:a copy -c:v libx264 -vpre slow -f flv “rtmp:&#x2F;&#x2F;server&#x2F;live&#x2F;h264Stream live&#x3D;1〃</span><br></pre></td></tr></table></figure>

<p><strong>视频采集相关:</strong></p>
<p>1.采集usb摄像头视频命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ffmpeg -t 20 -f vfwcap -i 0 -r 8 -f mp4 cap1111.mp4</span><br><span class="line"></span><br><span class="line">.&#x2F;ffmpeg -t 10 -f vfwcap -i 0 -r 8 -f mp4 cap.mp4</span><br><span class="line"></span><br><span class="line">具体说明如下：我们采集10秒，采集设备为vfwcap类型设备，第0个vfwcap采集设备（如果系统有多个vfw的视频采集设备，可以通过-i num来选择），每秒8帧，输出方式为文件，格式为mp4。</span><br></pre></td></tr></table></figure>
<p>2.最简单的抓屏：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ffmpeg -f gdigrab -i desktop out.mpg</span><br></pre></td></tr></table></figure>
<p>3.从屏幕的（10,20）点处开始，抓取640x480的屏幕，设定帧率为5 ：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ffmpeg -f gdigrab -framerate 5 -offset_x 10 -offset_y 20 -video_size 640x480 -i desktop out.mpg</span><br></pre></td></tr></table></figure>
<p>4.ffmpeg从视频中生成gif图片：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ffmpeg -i capx.mp4 -t 10 -s 320x240 -pix_fmt rgb24 jidu1.gif</span><br></pre></td></tr></table></figure>
<p>5.ffmpeg将图片转换为视频：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;blog.sina.com.cn&#x2F;s&#x2F;blog_40d73279010113c2.html</span><br></pre></td></tr></table></figure>
<p><strong>音频转换：</strong></p>
<p>1.转换amr到mp3：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ffmpeg -i shenhuxi.amr amr2mp3.mp3</span><br></pre></td></tr></table></figure>
<p>2.转换amr到wav：</p>
<p>ffmpeg -acodec libamr_nb -i shenhuxi.amr amr2wav.wav<br>3.转换mp3到wav：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ffmpeg -i DING.mp3 -f wav test.wav</span><br></pre></td></tr></table></figure>
<p>4.转换wav到amr：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ffmpeg -i test.wav -acodec libamr_nb -ab 12.2k -ar 8000 -ac 1 wav2amr.amr</span><br></pre></td></tr></table></figure>
<p>5.转换wav到mp3：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ffmpeg -i test.wav -f mp3 -acodec libmp3lame -y wav2mp3.mp3</span><br></pre></td></tr></table></figure>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2015/12/24/mysql-server-has-gone-away/">MySQL server has gone away 问题</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2015-12-24</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/mysql/">mysql</a></span><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/mysql/">mysql</a></span><div class="content"><p>导入数据遇到的：<code>ERROR : (2006, &#39;MySQL server has gone away&#39;)</code> 意思就是连接断开了。</p>
<p>主要看下面几个参数：</p>
<p>1.是否重启过，如果uptime太短就是最近重启过</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [(none)]&gt; show global status like &#39;uptime&#39;;</span><br><span class="line">+---------------+-------+</span><br><span class="line">| Variable_name | Value |</span><br><span class="line">+---------------+-------+</span><br><span class="line">| Uptime        | 68600 |</span><br><span class="line">+---------------+-------+</span><br><span class="line">1 row in set (0.93 sec)</span><br></pre></td></tr></table></figure>
<p>2.查看无操作多久后会自动关闭</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [(none)]&gt; show global variables like &#39;%timeout&#39;;</span><br><span class="line">+----------------------------+----------+</span><br><span class="line">| Variable_name              | Value    |</span><br><span class="line">+----------------------------+----------+</span><br><span class="line">| connect_timeout            | 10       |</span><br><span class="line">| delayed_insert_timeout     | 300      |</span><br><span class="line">| innodb_lock_wait_timeout   | 50       |</span><br><span class="line">| innodb_rollback_on_timeout | OFF      |</span><br><span class="line">| interactive_timeout        | 28800    |</span><br><span class="line">| lock_wait_timeout          | 31536000 |</span><br><span class="line">| net_read_timeout           | 30       |</span><br><span class="line">| net_write_timeout          | 60       |</span><br><span class="line">| slave_net_timeout          | 3600     |</span><br><span class="line">| thread_pool_idle_timeout   | 60       |</span><br><span class="line">| wait_timeout               | 28800    |</span><br><span class="line">+----------------------------+----------+</span><br><span class="line">11 rows in set (0.01 sec)</span><br></pre></td></tr></table></figure>
<p>如果wait_timeout太短就在<code>my.ini</code>或者<code>my.cnf</code>中修改一下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">wait_timeout&#x3D;2880000</span><br><span class="line">interactive_timeout &#x3D; 2880000</span><br><span class="line">max_allowed_packet &#x3D; 512M</span><br></pre></td></tr></table></figure>

<p>3.进程主动kill掉，主要就是这个了，由于是导入数据，肯定就是这个<code>max_allowed_packet</code>太小了</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [(none)]&gt; show global status like &#39;com_kill&#39;;</span><br><span class="line">+---------------+-------+</span><br><span class="line">| Variable_name | Value |</span><br><span class="line">+---------------+-------+</span><br><span class="line">| Com_kill      | 10    |</span><br><span class="line">+---------------+-------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line">MariaDB [(none)]&gt; show global variables like &#39;max_allowed_packet&#39;;</span><br><span class="line">+--------------------+---------+</span><br><span class="line">| Variable_name      | Value   |</span><br><span class="line">+--------------------+---------+</span><br><span class="line">| max_allowed_packet | 1048576 |</span><br><span class="line">+--------------------+---------+</span><br><span class="line">1 row in set (0.01 sec)</span><br></pre></td></tr></table></figure>

<p>那就设置大一点儿就行了，这个也可以在上面的那个文件里修改：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [(none)]&gt; set global max_allowed_packet&#x3D;1024*1024*16;</span><br><span class="line">Query OK, 0 rows affected (0.03 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; show global variables like &#39;max_allowed_packet&#39;;</span><br><span class="line">+--------------------+----------+</span><br><span class="line">| Variable_name      | Value    |</span><br><span class="line">+--------------------+----------+</span><br><span class="line">| max_allowed_packet | 16777216 |</span><br><span class="line">+--------------------+----------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>
</div><hr></div><nav id="pagination"><div class="pagination"><span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-chevron-right"></i></a></div></nav></div></div><footer><div class="layout" id="footer"><div class="copyright">&copy;2013 - 2021 By y500</div><div class="framework-info"><span>Driven - </span><a href="http://hexo.io" target="_blank" rel="noopener"><span>Hexo</span></a><span class="footer-separator">|</span><span>Theme - </span><a href="https://github.com/Molunerfinn/hexo-theme-melody" target="_blank" rel="noopener"><span>Melody</span></a></div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_site_uv"><i class="fa fa-user"></i><span id="busuanzi_value_site_uv"></span><span></span></span><span class="footer-separator">|</span><span id="busuanzi_container_site_pv"><i class="fa fa-eye"></i><span id="busuanzi_value_site_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.9.0"></script><script src="/js/fancybox.js?version=1.9.0"></script><script src="/js/sidebar.js?version=1.9.0"></script><script src="/js/copy.js?version=1.9.0"></script><script src="/js/fireworks.js?version=1.9.0"></script><script src="/js/transition.js?version=1.9.0"></script><script src="/js/scroll.js?version=1.9.0"></script><script src="/js/head.js?version=1.9.0"></script><script>if(/Android|webOS|iPhone|iPod|iPad|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
  $('#top-container').addClass('is-mobile')
}</script></body></html>