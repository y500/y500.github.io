<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content=""><meta name="keywords" content=""><meta name="author" content="y500"><meta name="copyright" content="y500"><title>stay hungry, stay foolish | study and record</title><link rel="shortcut icon" href="/melody-favicon.ico"><link rel="stylesheet" href="/css/index.css?version=1.7.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.7.0"><meta name="format-detection" content="telephone=no"><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  }
} </script><meta name="generator" content="Hexo 4.2.0"></head><body><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar" data-display="false"><div class="author-info"><div class="author-info__avatar text-center"><img src="/img/avatar.png"></div><div class="author-info__name text-center">y500</div><div class="author-info__description text-center"></div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">Articles</span><span class="pull-right">11</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">Tags</span><span class="pull-right">9</span></a><a class="author-info-articles__categories article-meta" href="/categories"><span class="pull-left">Categories</span><span class="pull-right">5</span></a></div></div></div><nav class="no-bg" id="nav"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">study and record</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus">   <a class="site-page" href="/">Home</a><a class="site-page" href="/archives">Archives</a><a class="site-page" href="/tags">Tags</a><a class="site-page" href="/categories">Categories</a></span><span class="pull-right"></span></div><div id="site-info"><div id="site-title">study and record</div><div id="site-sub-title">stay hungry, stay foolish</div></div></nav><div id="content-outer"><div class="layout" id="content-inner"><div class="recent-post-item article-container"><a class="article-title" href="/2020/09/29/image-not-render-on-ios14/">iOS 14ä¸‹é¢å›¾ç‰‡æ— æ³•åŠ è½½ï¼ŒåŒ…æ‹¬weexã€YYAnimateViewã€SDAnimatedImageView</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2020-09-29</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/Objective-C/">Objective-C</a></span><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/iOS-weex-YYAnimateView-SDAnimatedImageView/">iOS weex YYAnimateView SDAnimatedImageView</a></span><div class="content"><p>å‡çº§xcode12åï¼Œç¼–è¯‘è¿è¡ŒAppå‘ç°å¤§ç‰‡å¤§ç‰‡çš„å›¾ç‰‡åŠ è½½ä¸å‡ºæ¥ï¼ŒåŒ…æ‹¬weexçš„å›¾ç‰‡å’ŒYYAnimateViewçš„å›¾ç‰‡éƒ½æœ‰é—®é¢˜ã€‚</p>
<p>ç»è¿‡ä¸€ç•ªç ”ç©¶ä¹‹åï¼Œå‘ç°æ˜¯iOS 14ä¸‹UIKitå¯¹ <code>displayLayer:</code>çš„å¤„ç†æœºåˆ¶æœ‰æ‰€å˜åŒ–ã€‚<br><code>displayLayer:</code>æ˜¯<code>CALayerDelegate</code>çš„ä»£ç†æ–¹æ³•ã€‚åœ¨iOS 14ä¹‹å‰ï¼ŒUIKitåœ¨è°ƒç”¨è¿™ä¸ªæ–¹æ³•ä¹‹å‰å°±ä¼šå»æ¸²æŸ“<code>UIImageView.image</code>ã€‚<br>è€Œåœ¨iOS 14ï¼ŒUIKitåˆ™æ˜¯å…ˆå»è°ƒç”¨ä»£ç†æ–¹æ³•ï¼Œå¦‚æœä½ å®ç°äº†<code>displayLayer:</code>è¿™ä¸ªæ–¹æ³•ï¼Œé‚£ä¹ˆUIKitå°±ä¸ä¼šå†å»æ¸²æŸ“äº†ã€‚</p>
<p>å¦‚æœæ”¹æˆä¸‹é¢è¿™æ ·å°±å¯ä»¥æ­£å¸¸åŠ è½½äº†ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">- (void)displayLayer:(CALayer *)layer &#123;</span><br><span class="line">    UIImage *currentFrame &#x3D; _curFrame;</span><br><span class="line">    if (currentFrame) &#123;</span><br><span class="line">        layer.contentsScale &#x3D; currentFrame.scale;</span><br><span class="line">        layer.contents &#x3D; (__bridge id)currentFrame.CGImage;</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        &#x2F;&#x2F; If we have no animation frames, call super implementation. iOS 14+ UIImageView use this delegate method for rendering.</span><br><span class="line">        if ([UIImageView instancesRespondToSelector:@selector(displayLayer:)]) &#123;</span><br><span class="line">           [super displayLayer:layer];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#x2F;&#x2F;    if (_curFrame) &#123;</span><br><span class="line">&#x2F;&#x2F;        layer.contents &#x3D; (__bridge id)_curFrame.CGImage;</span><br><span class="line">&#x2F;&#x2F;    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å‚è€ƒï¼š</p>
<ol>
<li><a href="https://github.com/apache/incubator-weex/issues/3265" target="_blank" rel="noopener">https://github.com/apache/incubator-weex/issues/3265</a></li>
<li><a href="https://github.com/ibireme/YYWebImage/issues/242" target="_blank" rel="noopener">https://github.com/ibireme/YYWebImage/issues/242</a></li>
<li><a href="https://github.com/SDWebImage/SDWebImage/issues/3040" target="_blank" rel="noopener">https://github.com/SDWebImage/SDWebImage/issues/3040</a></li>
</ol>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2020/09/27/ios14_taobao_uipasteboard/">iOS14å‰ªåˆ‡æ¿æ¢ç©¶ï¼Œæ·˜å®å®ç°æ–¹æ³•åˆ†æå’Œå®ç°Demo</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2020-09-27</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/Objective-C/">Objective-C</a></span><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/iOS/">iOS</a></span><div class="content"><p>éšç€iOS 14çš„å‘å¸ƒï¼Œå‰ªåˆ‡æ¿çš„æ»¥ç”¨ä¹Ÿè¢«å¤§å®¶æ‰€çŸ¥æ™“ã€‚åªè¦æ˜¯APPè¯»å–å‰ªåˆ‡æ¿å†…å®¹ï¼Œç³»ç»Ÿéƒ½ä¼šåœ¨é¡¶éƒ¨å¼¹å‡ºæé†’ï¼Œè€Œä¸”è¿™ä¸ªæé†’ä¸èƒ½å¤Ÿå…³é—­ã€‚è¿™æ ·ï¼Œå¤§å®¶åœ¨ä½¿ç”¨APPçš„è¿‡ç¨‹ä¸­å°±èƒ½å¤Ÿçœ‹åˆ°å“ªäº›APPä½¿ç”¨äº†å‰ªåˆ‡æ¿ã€‚</p>
<p>æ­£å¥½æˆ‘ä»¬è‡ªå·±çš„åº”ç”¨ä¹Ÿä½¿ç”¨äº†å‰ªåˆ‡æ¿ï¼Œå‡çº§äº†iOS 14ä¹‹åå¼¹çš„ç€å®è®©äººå¿ƒçƒ¦ã€‚å°±æƒ³ç€æ€ä¹ˆå¤„ç†ä¸€ä¸‹ï¼Œç¿»äº†ä¸€ä¸‹<code>UIPasteboard</code>çš„æ–‡æ¡£ï¼Œå‘ç°ç›¸å…³çš„å†…å®¹å¹¶ä¸å¤šã€‚<br>è¯»å–<code>UIPasteboard</code>çš„<code>string</code>ã€<code>strings</code>ã€<code>URL</code>ã€<code>URLs</code>ã€<code>image</code>ã€<code>images</code>ã€<code>color</code>ã€<code>colors</code>çš„æ—¶å€™ä¼šè§¦å‘ç³»ç»Ÿæç¤ºã€‚<br>ä½¿ç”¨<code>hasStrings</code>ã€<code>hasURLs</code>ã€<code>hasImages</code>ã€<code>hasColors</code>ç­‰æ–¹æ³•çš„æ—¶å€™ä¸ä¼šè§¦å‘ç³»ç»Ÿæç¤ºã€‚<br>é‚£ä¹ˆæ€è·¯å°±æ˜¯å°½å¯èƒ½å°‘çš„å»è°ƒç”¨ä¼šè§¦å‘ç³»ç»Ÿæç¤ºçš„æ–¹æ³•ï¼Œæ ¹æ®å…¶ä»–æ–¹æ³•å»åˆ¤æ–­ç¡®å®éœ€è¦è¯»å–çš„æ—¶å€™å†å»è°ƒç”¨é‚£äº›æ–¹æ³•ã€‚<br>æ ¹æ®æˆ‘ä»¬è‡ªå·±çš„æƒ…å†µï¼Œåªæœ‰åˆ¤æ–­<code>hasStrings</code>ä¸º<code>YES</code>å°±å»è¯»å–ï¼Œåˆä¸èƒ½æ¸…å‰ªåˆ‡æ¿ï¼Œå…¶å®è¿˜æ˜¯æœ‰ç‚¹ä¸å°½äººæ„ï¼Œç„¶ååˆçœ‹åˆ°è¿™ä¸ªå±æ€§ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@property(readonly, nonatomic) NSInteger changeCount;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">The number of times the pasteboardâ€™s contents have changed.</span><br><span class="line"></span><br><span class="line">Whenever the contents of a pasteboard changesâ€”specifically, when pasteboard items are added, modified, or removedâ€”UIPasteboard increments the value of this property. After it increments the change count, UIPasteboard posts the notifications named UIPasteboardChangedNotification (for additions and modifications) and UIPasteboardRemovedNotification (for removals). These notifications include (in the userInfo dictionary) the types of the pasteboard items added or removed. Because UIPasteboard waits until the end of the current event loop before incrementing the change count, notifications can be batched. The class also updates the change count when an app reactivates and another app has changed the pasteboard contents. When users restart a device, the change count is reset to zero.</span><br></pre></td></tr></table></figure>
<p>ç„¶åå°±åˆåŠ äº†ä¸€ä¸ªæ¡ä»¶ï¼Œè®°å½•ä¸€ä¸‹çœŸæ­£è¯»å–å‰ªåˆ‡æ¿æ—¶çš„<code>changeCount</code>ï¼Œå¦‚æœä¸‹æ¬¡è¯»å–çš„æ—¶å€™æ²¡æœ‰å‘ç”Ÿå˜åŒ–åˆ™ä¸è¯»å–ã€‚<br>è¿™æ ·ä¸€æ¥æ•ˆæœå°±å¥½å¤šäº†ï¼Œåº”ç”¨è¿è¡Œç”Ÿå‘½å‘¨æœŸå†…ï¼ŒåŸºæœ¬ä¸Šåªä¼šå¼¹å‡ºä¸€æ¬¡æç¤ºã€‚</p>
<p>ä½†æ˜¯ï¼Œåæ¥çœ‹åˆ°æ·˜å®æ›´ç‰›é€¼ï¼Œå‘½ä¸­äº†çœŸæ­£åˆ†äº«å‡ºæ¥çš„å†…å®¹æ‰ä¼šå¼¹ï¼Œå…¶ä»–åˆ™ä¸ä¼šå¼¹ã€‚ç„¶åå°±ç ”ç©¶äº†ä¸€ä¸‹æ·˜å®çš„åˆ†äº«å†…å®¹å’Œæ–°çš„APIæ–‡æ¡£ï¼Œå¤§æ¦‚å¾—åˆ°äº†ç­”æ¡ˆã€‚<br>å…ˆçœ‹ä¸‹æ·˜å®çš„åˆ†äº«å†…å®¹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">9ğŸ‘ˆå¹…æ²»å†…å®¹ Http:&#x2F;T$AJg8c4IfW3q$æ‰“é–‹ğŸ‘‰ç»¹..å¯¶ğŸ‘ˆã€è´µå·èŒ…å°é…’ èŒ…å° é£å¤©53åº¦é…±é¦™å‹ç™½é…’æ”¶è— 500ml*1å•ç“¶è£…é€ç¤¼é«˜åº¦ã€‘</span><br></pre></td></tr></table></figure>
<p>ç»„æˆéƒ¨åˆ†ï¼šæ•°å­—+æ–‡å­—+é“¾æ¥çš„å½¢åŠ¿ï¼Œå†ç»“åˆiOS 14æä¾›çš„æ–°APIï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">detectPatternsForPatterns:completionHandler:</span><br><span class="line">detectPatternsForPatterns:inItemSet:completionHandler:</span><br></pre></td></tr></table></figure>

<p>è€Œ<code>UIPasteboardDetectionPattern</code>ç³»ç»Ÿåªæä¾›äº†ä¸‰ç§ï¼š</p>
<ol>
<li>æ•°å­— <code>UIPasteboardDetectionPatternNumber</code></li>
<li>é“¾æ¥ <code>UIPasteboardDetectionPatternProbableWebURL</code></li>
<li>æœç´¢<code>UIPasteboardDetectionPatternProbableWebSearch</code></li>
</ol>
<p>å¤§èƒ†çŒœæµ‹ï¼Œæ·˜å®åº”è¯¥æ˜¯é€šè¿‡åˆ¤æ–­æ˜¯å¦ç¬¦åˆæ•°å­—å’Œé“¾æ¥çš„è§„åˆ™æ¥åˆ¤æ–­æ˜¯å¦å‘½ä¸­åˆ†äº«å†…å®¹ã€‚</p>
<p>ç„¶åå°±å†™äº†ä¸€ä¸ªdemoæ¥éªŒè¯ï¼Œæ ¸å¿ƒä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">UIPasteboard *board &#x3D; [UIPasteboard generalPasteboard];</span><br><span class="line">    </span><br><span class="line">[board detectPatternsForPatterns:[NSSet setWithObjects:UIPasteboardDetectionPatternProbableWebURL, UIPasteboardDetectionPatternNumber, UIPasteboardDetectionPatternProbableWebSearch, nil]</span><br><span class="line">                   completionHandler:^(NSSet&lt;UIPasteboardDetectionPattern&gt; * _Nullable set, NSError * _Nullable error) &#123;</span><br><span class="line">        </span><br><span class="line">        BOOL hasNumber &#x3D; NO, hasURL &#x3D; NO;</span><br><span class="line">        for (NSString *type in set) &#123;</span><br><span class="line">            if ([type isEqualToString:UIPasteboardDetectionPatternProbableWebURL]) &#123;</span><br><span class="line">                hasURL &#x3D; YES;</span><br><span class="line">            &#125; else if ([type isEqualToString:UIPasteboardDetectionPatternNumber]) &#123;</span><br><span class="line">                hasNumber &#x3D; YES;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        if (hasNumber &amp;&amp; hasURL) &#123;</span><br><span class="line">            </span><br><span class="line">            dispatch_async(dispatch_get_main_queue(), ^&#123;</span><br><span class="line">                UIAlertController *alert &#x3D; [UIAlertController alertControllerWithTitle:@&quot;æ¸©é¦¨æç¤º&quot; message:[NSString stringWithFormat:@&quot;%@\n%@&quot;, [board string], @&quot;ç¬¦åˆæ·˜å®çš„è¯»å–æ ‡å‡†&quot;] preferredStyle:UIAlertControllerStyleAlert];</span><br><span class="line">                UIAlertAction *cancelAction &#x3D; [UIAlertAction actionWithTitle:@&quot;ç¡®å®š&quot; style:UIAlertActionStyleCancel handler:nil];</span><br><span class="line">                [alert addAction:cancelAction];</span><br><span class="line">                [self presentViewController:alert animated:YES completion:nil];</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;];</span><br></pre></td></tr></table></figure>

<p>ç„¶åæ„é€ äº†ä¸€ä¸ªçœ‹èµ·æ¥ç¬¦åˆæ¡ä»¶<code>1 http:/123abc</code>çš„ä¸²å»åå‘éªŒè¯äº†ä¸€ä¸‹å‘ç°demoå’Œæ·˜å®çš„ç»“æœçš„è¡¨ç°æ˜¯ä¸€è‡´çš„ï¼Œéƒ½å¼¹äº†ç³»ç»Ÿæç¤ºã€‚</p>
<p>å…·ä½“çš„demoå¯å»<a href="https://github.com/y500/ios14_uipasteboard" target="_blank" rel="noopener">github</a>ä¸‹è½½ã€‚</p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2020/09/25/flutter-xcode12-ios14-crash/">iOS14 debugå®‰è£…çš„å¸¦æœ‰flutteråº”ç”¨ä»æ¡Œé¢å›¾æ ‡é‡æ–°å¯åŠ¨æ—¶é—ªé€€</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2020-09-25</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/Objective-C/">Objective-C</a></span><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/iOS/">iOS</a></span><div class="content"><p>åˆšåˆšå‡çº§é‡åˆ°çš„é—®é¢˜ï¼Œå¸Œæœ›èƒ½å¤Ÿå¸®åŠ©åˆ°é‡åˆ°ç›¸åŒé—®é¢˜çš„äººã€‚</p>
<ol>
<li>ç”¨xcode12è¿æ¥iOSè®¾å¤‡è°ƒè¯•å®‰è£…åº”ç”¨</li>
<li>æ‹”æ‰æ•°æ®çº¿</li>
<li>ä»æ¡Œé¢å›¾æ ‡ç‚¹å‡»è¿›å…¥Appå¿…é—ªé€€</li>
</ol>
<p>åæ¥å‘ç°æ˜¯flutterçš„åŸå› ï¼Œç›®å‰æœ‰ä¸‹é¢ä¸¤ç§ä¸ªè§£å†³æ–¹æ¡ˆï¼š</p>
<ol>
<li>ä½¿ç”¨flutterçš„releaseæ¨¡å¼ <code>flutter run --release</code></li>
<li>ä½¿ç”¨flutterçš„betaç‰ˆæœ¬v1.22</li>
</ol>
<p>å‚è€ƒæ–‡ç« ï¼š</p>
<ol>
<li><a href="https://medium.com/flutter/supporting-ios-14-and-xcode-12-with-flutter-15fe0062e98b" target="_blank" rel="noopener">https://medium.com/flutter/supporting-ios-14-and-xcode-12-with-flutter-15fe0062e98b</a></li>
<li><a href="https://github.com/flutter/flutter/issues/66175" target="_blank" rel="noopener">https://github.com/flutter/flutter/issues/66175</a></li>
</ol>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2020/06/29/JavaScript-Depth-of-Tree/">ç”¨JavaScriptå®ç°æ ‘çš„å‰åºã€ä¸­åºã€åç»­æŸ¥è¯¢ä»¥åŠé«˜åº¦è®¡ç®—</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2020-06-29</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/Javascript/">Javascript</a></span><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/tree/">tree</a><span class="article-meta__link">-</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/data-structure/">data structure</a></span><div class="content"><p>ç”¨JavaScriptå®ç°æ ‘çš„å‰åºã€ä¸­åºã€åç»­æŸ¥è¯¢ä»¥åŠé«˜åº¦è®¡ç®—</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TreeNode</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span> (value) &#123;</span><br><span class="line">        <span class="keyword">this</span>.value = value;</span><br><span class="line">        <span class="keyword">this</span>.left = <span class="keyword">this</span>.right = <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> maxDepth = <span class="function"><span class="keyword">function</span>(<span class="params">troot</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!troot) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> left = maxDepth(troot.left);</span><br><span class="line">    <span class="keyword">const</span> right = maxDepth(troot.right);</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Math</span>.max(left, right) + <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> preOrder = <span class="function"><span class="keyword">function</span>(<span class="params">root</span>) </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (!root) &#123;</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">console</span>.log(root.value);</span><br><span class="line">	preOrder(root.left);</span><br><span class="line">	preOrder(root.right);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> preOrderWithoutRescursion = <span class="function"><span class="keyword">function</span>(<span class="params">root</span>) </span>&#123;</span><br><span class="line">	<span class="keyword">let</span> stack = [];</span><br><span class="line">	<span class="keyword">let</span> pointNode = root;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">while</span>(pointNode || stack.length &gt; <span class="number">0</span>) &#123;</span><br><span class="line">		<span class="keyword">while</span>(pointNode) &#123;</span><br><span class="line">			<span class="built_in">console</span>.log(pointNode.value);</span><br><span class="line">			stack.push(pointNode);</span><br><span class="line">			pointNode = pointNode.left;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> (stack.length &gt; <span class="number">0</span>) &#123;</span><br><span class="line">			pointNode = stack.pop();</span><br><span class="line">			pointNode = pointNode.right;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> midOrder = <span class="function"><span class="keyword">function</span>(<span class="params">root</span>) </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (!root) &#123;</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	midOrder(root.left);</span><br><span class="line">	<span class="built_in">console</span>.log(root.value);</span><br><span class="line">	midOrder(root.right);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> midOrderWithoutRescursion = <span class="function"><span class="keyword">function</span>(<span class="params">root</span>) </span>&#123;</span><br><span class="line">	<span class="keyword">let</span> stack = [];</span><br><span class="line">	<span class="keyword">let</span> pointNode = root;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">while</span>(pointNode || stack.length &gt; <span class="number">0</span>) &#123;</span><br><span class="line">		<span class="keyword">while</span>(pointNode) &#123;</span><br><span class="line">			stack.push(pointNode);</span><br><span class="line">			pointNode = pointNode.left;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> (stack.length &gt; <span class="number">0</span>) &#123;</span><br><span class="line">			pointNode = stack.pop();</span><br><span class="line">			<span class="built_in">console</span>.log(pointNode.value);</span><br><span class="line">			pointNode = pointNode.right;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> postOrder = <span class="function"><span class="keyword">function</span>(<span class="params">root</span>) </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (!root) &#123;</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	postOrder(root.left);</span><br><span class="line">	postOrder(root.right);</span><br><span class="line">	<span class="built_in">console</span>.log(root.value);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> postOrderWithoutRescursion = <span class="function"><span class="keyword">function</span>(<span class="params">root</span>) </span>&#123;</span><br><span class="line">	<span class="keyword">let</span> stack = [];</span><br><span class="line">	<span class="keyword">let</span> pointNode = root;</span><br><span class="line">	<span class="keyword">let</span> right = root;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">while</span>(pointNode || stack.length &gt; <span class="number">0</span>) &#123;</span><br><span class="line">		<span class="keyword">if</span> (pointNode) &#123;</span><br><span class="line">			stack.push(pointNode);</span><br><span class="line">			pointNode = pointNode.left;</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			pointNode = stack.length &gt; <span class="number">0</span> ? stack[stack.length - <span class="number">1</span>] : <span class="literal">null</span>;</span><br><span class="line">			<span class="keyword">if</span> (pointNode.right &amp;&amp; pointNode.right != right) &#123;</span><br><span class="line">				pointNode = pointNode.right;</span><br><span class="line">			&#125; <span class="keyword">else</span>&#123;</span><br><span class="line">				pointNode = stack.pop();</span><br><span class="line">				<span class="built_in">console</span>.log(pointNode.value);</span><br><span class="line">				right = pointNode;</span><br><span class="line">				pointNode = <span class="literal">null</span>;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> levelOrder = <span class="function"><span class="keyword">function</span>(<span class="params">root</span>) </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (!root) &#123;</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">let</span> queue = [];</span><br><span class="line">	queue.unshift(root);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">while</span>(queue.length &gt; <span class="number">0</span>) &#123;</span><br><span class="line">		<span class="keyword">let</span> pointNode = queue.pop();</span><br><span class="line">		<span class="built_in">console</span>.log(pointNode.value);</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> (pointNode.left) &#123;</span><br><span class="line">			queue.unshift(pointNode.left)</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> (pointNode.right) &#123;</span><br><span class="line">			queue.unshift(pointNode.right);</span><br><span class="line">		&#125;		</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> tree = <span class="keyword">new</span> TreeNode(<span class="number">3</span>);</span><br><span class="line">tree.left = <span class="keyword">new</span> TreeNode(<span class="number">9</span>);</span><br><span class="line">tree.right = <span class="keyword">new</span> TreeNode(<span class="number">20</span>);</span><br><span class="line">tree.right.left = <span class="keyword">new</span> TreeNode(<span class="number">15</span>);</span><br><span class="line">tree.right.right = <span class="keyword">new</span> TreeNode(<span class="number">7</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> depth = maxDepth(tree);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"depth:"</span>+depth);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"pre order:"</span>);</span><br><span class="line">preOrder(tree);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"mid order:"</span>);</span><br><span class="line">midOrder(tree)</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"post order:"</span>);</span><br><span class="line">postOrder(tree)</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"pre order without recursion"</span>);</span><br><span class="line">preOrderWithoutRescursion(tree);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"mid order without recursion"</span>);</span><br><span class="line">midOrderWithoutRescursion(tree);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"post order without recursion"</span>);</span><br><span class="line">postOrderWithoutRescursion(tree);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"level order"</span>);</span><br><span class="line">levelOrder(tree);</span><br></pre></td></tr></table></figure>

<p>è¿è¡Œç»“æœï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">depth:3</span><br><span class="line">pre order:</span><br><span class="line">3</span><br><span class="line">9</span><br><span class="line">20</span><br><span class="line">15</span><br><span class="line">7</span><br><span class="line">mid order:</span><br><span class="line">9</span><br><span class="line">3</span><br><span class="line">15</span><br><span class="line">20</span><br><span class="line">7</span><br><span class="line">post order:</span><br><span class="line">9</span><br><span class="line">15</span><br><span class="line">7</span><br><span class="line">20</span><br><span class="line">3</span><br><span class="line">pre order without recursion</span><br><span class="line">3</span><br><span class="line">9</span><br><span class="line">20</span><br><span class="line">15</span><br><span class="line">7</span><br><span class="line">mid order without recursion</span><br><span class="line">9</span><br><span class="line">3</span><br><span class="line">15</span><br><span class="line">20</span><br><span class="line">7</span><br><span class="line">post order without recursion</span><br><span class="line">9</span><br><span class="line">15</span><br><span class="line">7</span><br><span class="line">20</span><br><span class="line">3</span><br><span class="line">level order</span><br><span class="line">3</span><br><span class="line">9</span><br><span class="line">20</span><br><span class="line">15</span><br><span class="line">7</span><br></pre></td></tr></table></figure>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2017/11/15/NSObject/">NSObjectä¸­ç±»æ–¹æ³•loadå’Œinitialize</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2017-11-15</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/Objectve-C/">Objectve-C</a></span><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/iOS/">iOS</a><span class="article-meta__link">-</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/Objective-c/">Objective-c</a><span class="article-meta__link">-</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/load/">load</a><span class="article-meta__link">-</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/initialize/">initialize</a></span><div class="content"><p>+loadå’Œ+initializeæ˜¯NSObjectçš„ä¸¤ä¸ªç±»æ–¹æ³•ï¼Œè¿™ä¸¤ä¸ªç±»æ–¹æ³•ä¼šåœ¨ç±»è¢«ä½¿ç”¨æ—¶ä¸»åŠ¨è°ƒç”¨ï¼Œä½†æ˜¯è°ƒç”¨æ—¶æœºå’Œè°ƒç”¨é¡ºåºå´æˆªç„¶ä¸åŒã€‚</p>
<p>å…ˆçœ‹çœ‹è‹¹æœçš„<a href="https://developer.apple.com/documentation/objectivec/nsobject#//apple_ref/occ/cl/NSObject" target="_blank" rel="noopener">å®˜æ–¹æ–‡æ¡£é‡Œé¢</a>ï¼š</p>
<h3 id="Initialize"><a href="#Initialize" class="headerlink" title="Initialize"></a>Initialize</h3><blockquote>
<p>###Initializing a Class<br>class func initialize()<br>Initializes the class before it receives its first message.</p>
</blockquote>
<blockquote>
<p>he runtime sends initialize() to each class in a program just before the class, or any class that inherits from it, is sent its first message from within the program. Superclasses receive this message before their subclasses.<br>The runtime sends the initialize() message to classes in a thread-safe manner. That is, initialize() is run by the first thread to send a message to a class, and any other thread that tries to send a message to that class will block until initialize() completes.<br>The superclass implementation may be called multiple times if subclasses do not implement initialize()â€”the runtime will call the inherited implementationâ€”or if subclasses explicitly call [super initialize]. If you want to protect yourself from being run multiple times, you can structure your implementation along these lines:</p>
</blockquote>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">+ (<span class="keyword">void</span>)initialize &#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">self</span> == [ClassName <span class="keyword">self</span>]) &#123;</span><br><span class="line">    <span class="comment">// ... do the initialization ...</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Because initialize() is called in a blocking manner, itâ€™s important to limit method implementations to the minimum amount of work necessary possible. Specifically, any code that takes locks that might be required by other classes in their initialize() methods is liable to lead to deadlocks. Therefore, you should not rely on initialize() for complex initialization, and should instead limit it to straightforward, class local initialization.</p>
</blockquote>
<blockquote>
<p>initialize() is invoked only once per class. If you want to perform independent initialization for the class and for categories of the class, you should implement load() methods.</p>
</blockquote>
<ol>
<li><code>initialize</code>æ–¹æ³•æ˜¯åœ¨è¯¥ç±»æ¥æ”¶åˆ°ç¬¬ä¸€ä¸ªæ¶ˆæ¯ä¹‹å‰è°ƒç”¨.</li>
<li>çˆ¶ç±»çš„ <code>initialize</code> æ–¹æ³•å…ˆäºå­ç±»çš„ <code>initialize</code> æ–¹æ³•è°ƒç”¨.</li>
<li>å¦‚æœå­ç±»ä¸­æ²¡æœ‰å®ç° <code>initialize</code> æ–¹æ³•ï¼Œæˆ–è€…å­ç±»æ˜¾ç¤ºè°ƒç”¨çˆ¶ç±»å®ç° [super initialize], é‚£ä¹ˆåˆ™ä¼šè°ƒç”¨å…¶çˆ¶ç±»çš„å®ç°ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œçˆ¶ç±»çš„ <code>initialize</code> å¯èƒ½ä¼šè¢«è°ƒç”¨å¤šæ¬¡ã€‚</li>
<li>åœ¨åº”ç”¨ç¨‹åºç”Ÿå‘½å‘¨æœŸé‡Œï¼Œ<code>runtime</code> åªä¼šå‘æ¯ä¸ªç±»å‘é€ä¸€æ¬¡ <code>initialize</code> æ¶ˆæ¯. æ‰€ä»¥å¦‚æœcategoryä¸­å®ç°äº†<code>initialize</code>æ–¹æ³•ï¼Œé‚£ä¹ˆåŸæ¥ç±»ä¸­çš„åˆ™ä¸ä¼šè¢«è°ƒç”¨.</li>
</ol>
<p>çœ‹ä¸‹é¢çš„ä¾‹å­ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">SuperObject</span> : <span class="title">NSObject</span></span></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">SuperObject</span></span></span><br><span class="line">+ (<span class="keyword">void</span>)initialize &#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"%s"</span>, __FUNCTION__);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">SubObject</span> : <span class="title">SuperObject</span></span></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">SubObject</span></span></span><br><span class="line">+ (<span class="keyword">void</span>)initialize &#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"%s"</span>, __FUNCTION__);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> main(<span class="keyword">int</span> argc, <span class="keyword">char</span> * argv[]) &#123;</span><br><span class="line">    <span class="keyword">@autoreleasepool</span> &#123;</span><br><span class="line">        [SubObject <span class="keyword">class</span>];</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">UIApplicationMain</span>(argc, argv, <span class="literal">nil</span>, <span class="built_in">NSStringFromClass</span>([AppDelegate <span class="keyword">class</span>]));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¾“å‡ºï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">+[SuperObject initialize]</span><br><span class="line">+[SubObject initialize]</span><br></pre></td></tr></table></figure>

<p>å°±ç®—æŠŠmainå‡½æ•°ä¸­çš„<code>[SubObject class]</code>æ”¹ä¸ºï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[SubObject class];</span><br><span class="line">[[SubObject alloc] init];</span><br></pre></td></tr></table></figure>
<p>è¾“å‡ºè¿˜æ˜¯ä¸€æ ·ã€‚</p>
<p>æ·»åŠ ä¸€ä¸ªcategoryï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">SubObject</span> (<span class="title">category</span>)</span></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">SubObject</span> (<span class="title">category</span>)</span></span><br><span class="line">+ (<span class="keyword">void</span>)initialize &#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"%s"</span>, __FUNCTION__);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>

<p>è¾“å‡ºåˆ™ä¸ºï¼ˆcategoryä¸­æ–¹æ³•è¦†ç›–äº†åŸç±»ä¸­çš„æ–¹æ³•ï¼‰ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">+[SuperObject initialize]</span><br><span class="line">+[SubObject(category) initialize]</span><br></pre></td></tr></table></figure>

<h3 id="load"><a href="#load" class="headerlink" title="load"></a>load</h3><blockquote>
<p>###class func load()<br>Invoked whenever a class or category is added to the Objective-C runtime; implement this method to perform class-specific behavior upon loading.</p>
</blockquote>
<blockquote>
<p>The load() message is sent to classes and categories that are both dynamically loaded and statically linked, but only if the newly loaded class or category implements a method that can respond.<br>The order of initialization is as follows:</p>
</blockquote>
<pre><code>1. All initializers in any framework you link to.
2. All +load methods in your image.
3. All C++ static initializers and C/C++ __attribute__(constructor) functions in your image.
4. All initializers in frameworks that link to you.</code></pre><blockquote>
<p>In addition:</p>
</blockquote>
<pre><code>* A classâ€™s +load method is called after all of its superclassesâ€™ +load methods.
* A category +load method is called after the classâ€™s own +load method.</code></pre><blockquote>
<p>In a custom implementation of load() you can therefore safely message other unrelated classes from the same image, but any load() methods implemented by those classes may not have run yet.</p>
</blockquote>
<ol>
<li>åœ¨ç±»æˆ–è€…categoryè¢«æ·»åŠ åˆ°runtimeçš„æ—¶å€™è°ƒç”¨ï¼Œè¯¥è°ƒç”¨å‘ç”Ÿåœ¨mainå‡½æ•°ä¹‹å‰ã€‚</li>
<li>çˆ¶ç±»<code>load</code>æ–¹æ³•å…ˆäºå­ç±»è°ƒç”¨ï¼Œç±»æœ¬èº«<code>load</code>æ–¹æ³•å…ˆäºcategoryä¸­è°ƒç”¨ã€‚</li>
</ol>
<p>çœ‹ä¸‹é¢çš„ä¾‹å­ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">SuperObject</span> : <span class="title">NSObject</span></span></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">SuperObject</span></span></span><br><span class="line">+ (<span class="keyword">void</span>)initialize &#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"%@ , %s"</span>, [<span class="keyword">self</span> <span class="keyword">class</span>], __FUNCTION__);</span><br><span class="line">&#125;</span><br><span class="line">+ (<span class="keyword">void</span>)load &#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"%@, %s"</span>, [<span class="keyword">self</span> <span class="keyword">class</span>], __FUNCTION__);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">SubObject</span> : <span class="title">SuperObject</span></span></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">SubObject</span></span></span><br><span class="line">+ (<span class="keyword">void</span>)initialize &#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"%@, %s"</span>, [<span class="keyword">self</span> <span class="keyword">class</span>], __FUNCTION__);</span><br><span class="line">&#125;</span><br><span class="line">+ (<span class="keyword">void</span>)load &#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"%@, %s"</span>, [<span class="keyword">self</span> <span class="keyword">class</span>], __FUNCTION__);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">SubObject</span> (<span class="title">category</span>)</span></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">SubObject</span> (<span class="title">category</span>)</span></span><br><span class="line">+ (<span class="keyword">void</span>)initialize &#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"%@, %s"</span>, [<span class="keyword">self</span> <span class="keyword">class</span>], __FUNCTION__);</span><br><span class="line">&#125;</span><br><span class="line">+ (<span class="keyword">void</span>)load &#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"%@ %s"</span>, [<span class="keyword">self</span> <span class="keyword">class</span>], __FUNCTION__);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> main(<span class="keyword">int</span> argc, <span class="keyword">char</span> * argv[]) &#123;</span><br><span class="line">    <span class="keyword">@autoreleasepool</span> &#123;</span><br><span class="line">        SubObject *subObject = [[SubObject alloc] init];</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">UIApplicationMain</span>(argc, argv, <span class="literal">nil</span>, <span class="built_in">NSStringFromClass</span>([AppDelegate <span class="keyword">class</span>]));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¾“å‡ºç»“æœï¼ˆè¿™é‡Œæœ‰ç‚¹åœ°æ–¹è¦è§£é‡Šä¸€ä¸‹ï¼ŒæŒ‰ç…§æ–‡æ¡£çš„è¯´æ³•ï¼Œ<code>load</code>åº”è¯¥å’‹<code>initialize</code>ä¹‹å‰ï¼Œè¿™é‡Œå®åœ¨ä¹‹åï¼ŒåŸæ˜¯å› ä¸ºï¼Œ<code>load</code>æ–¹æ³•ä¸­è°ƒç”¨äº†<code>class</code>æ–¹æ³•ï¼Œä»è€Œè§¦å‘äº†<code>initialize</code>æ–¹æ³•ï¼Œæ‰€ä»¥å‡ºç°äº†è¿™ç§æƒ…å†µï¼‰ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">SuperObject , +[SuperObject initialize]</span><br><span class="line">SuperObject, +[SuperObject load]</span><br><span class="line">SubObject, +[SubObject(category) initialize]</span><br><span class="line">SubObject, +[SubObject load]</span><br><span class="line">SubObject +[SubObject(category) load]</span><br></pre></td></tr></table></figure>

<p>å†çœ‹ä¸€ä¸ªä¾‹å­ï¼Œå­ç±»ä¸­ä¸å®ç°<code>initialize</code>æ–¹æ³•ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">SuperObject</span> : <span class="title">NSObject</span></span></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">SuperObject</span></span></span><br><span class="line">+ (<span class="keyword">void</span>)initialize &#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"%@ , %s"</span>, [<span class="keyword">self</span> <span class="keyword">class</span>], __FUNCTION__);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">SubObject</span> : <span class="title">SuperObject</span></span></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">SubObject</span></span></span><br><span class="line">+ (<span class="keyword">void</span>)load &#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"%@, %s"</span>, [<span class="keyword">self</span> <span class="keyword">class</span>], __FUNCTION__);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> main(<span class="keyword">int</span> argc, <span class="keyword">char</span> * argv[]) &#123;</span><br><span class="line">    <span class="keyword">@autoreleasepool</span> &#123;</span><br><span class="line">        SubObject *subObject = [[SubObject alloc] init];</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">UIApplicationMain</span>(argc, argv, <span class="literal">nil</span>, <span class="built_in">NSStringFromClass</span>([AppDelegate <span class="keyword">class</span>]));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¾“å‡ºç»“æœå¦‚ä¸‹ï¼ˆå­ç±»è‡ªåŠ¨è°ƒäº†çˆ¶ç±»çš„<code>initialize</code>ï¼‰ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SuperObject , +[SuperObject initialize]</span><br><span class="line">SubObject , +[SuperObject initialize]</span><br><span class="line">SubObject, +[SubObject load]</span><br></pre></td></tr></table></figure>

<p><strong>ä¸éœ€è¦åœ¨<code>load</code>å’Œ<code>initialize</code>æ–¹æ³•ä¸­æ˜¾å¼çš„å»è°ƒç”¨çˆ¶ç±»çš„æ–¹æ³•ã€‚</strong></p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2017/04/13/Alloc-init/">Object-C Two-Stage Creationï¼šallocã€init</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2017-04-13</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/Objective-C/">Objective-C</a></span><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/iOS/">iOS</a></span><div class="content"><p>åœ¨å…¶ä»–è¯­ç§ä¸­ä¾‹å¦‚JAVAï¼ŒC++ï¼ŒRubyç­‰è¿™äº›è¯­è¨€ä¸­<code>new</code>æ˜¯å¾ˆå¸¸è§çš„ï¼Œä½†æ˜¯åœ¨object-cä¸­ï¼Œå¤§å®¶æœ€å¸¸è§åˆ°çš„å’Œæœ€å¸¸ç”¨çš„åˆå§‹åŒ–æ–¹æ³•å°±æ˜¯<code>[[ClassName alloc] init]</code>è€Œä¸æ˜¯<code>[ClassName new]</code> å»åˆå§‹åŒ–å¯¹è±¡ã€‚</p>
<p>å…ˆæ¥çœ‹çœ‹ä»–ä»¬çš„æ–¹æ³•å®ç°ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">+ new &#123;</span><br><span class="line">    <span class="keyword">id</span> newObject = (*_alloc)((Class)<span class="keyword">self</span>, <span class="number">0</span>);</span><br><span class="line">    Class metaClass = <span class="keyword">self</span>-&gt;isa;</span><br><span class="line">    <span class="keyword">if</span> (class_getVersion(metaClass) &gt; <span class="number">1</span>)</span><br><span class="line">        <span class="keyword">return</span> [newObject init];</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="keyword">return</span> newObject;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">+ alloc &#123;</span><br><span class="line">    <span class="keyword">return</span> (*_zoneAlloc)((Class)<span class="keyword">self</span>, <span class="number">0</span>, malloc_default_zone());  </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- init &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä»ä¸Šé¢çš„å®ç°æ–¹æ³•æ¥çœ‹ï¼Œå…¶å®å°±æ˜¯æŠŠ<code>new</code>æ‹†åˆ†æˆäº†<code>alloc</code>å’Œ<code>init</code>ï¼Œæ‰€ä»¥åœ¨Cocoaçš„æ–‡æ¡£ä¸­ï¼Œè¿™ç§åˆ›å»ºå¯¹è±¡çš„æ–¹æ³•ä¹Ÿè¢«å«åš <code>Two-Stage Creation</code></p>
<p>é¦–å…ˆæˆ‘ä»¬çœ‹çœ‹Cocoaè¿™ä¹ˆè®¾è®¡çš„åˆè¡·æ˜¯ä»€ä¹ˆ</p>
<ul>
<li>ä½¿ç”¨åˆå§‹åŒ–æ–¹æ³•çš„æ—¶å€™ï¼Œä¸éœ€è¦ç®¡å†…å­˜åˆ†é…çš„æ–¹å¼</li>
<li>å­ç±»åŒ–ä¸€ä¸ªå¯¹è±¡æ—¶ï¼Œé¿å…éœ€è¦å®ç°å¤ªå¤šçš„åˆå§‹åŒ–æ–¹æ³•</li>
<li>ç®€åŒ–ä¸´æ—¶å®ä¾‹çš„åˆ›å»ºå’Œä½¿ç”¨</li>
</ul>
<p>æ€ä¹ˆç†è§£å‘¢ï¼Œä¸¾ä¸ªä¾‹å­ï¼š<br>å‡å¦‚æœ‰è¿™æ ·ä¸€ä¸ªå¯¹è±¡ï¼Œå¤„äºä¸€äº›ç‰¹æ®ŠåŸå› ï¼Œæœ‰5ä¸­åˆ†é…å†…å­˜çš„æ–¹å¼å’Œ10ç§åˆå§‹åŒ–çš„æ–¹å¼ï¼Œå¦‚æœallocå’Œinitåœ¨ä¸€èµ·çš„ï¼Œé‚£ä¹ˆå°±éœ€è¦5*10ç§æ„é€ æ–¹æ³•ä¸ºæ¯ä¸€ç§å†…å­˜åˆ†é…æ–¹å¼ä¸‹æä¾›10ä¸­åˆå§‹åŒ–æ–¹å¼ã€‚å¦‚æœallocå’Œinitåˆ†å¼€çš„è¯ï¼Œå°±åªéœ€è¦åˆ†åˆ«æä¾›5ç§å†…å­˜åˆ†é…æ–¹å¼å’Œ10ä¸­åˆå§‹åŒ–çš„æ–¹å¼å°±å¯ä»¥äº†ã€‚</p>
<p>###alloc</p>
<p>NSObjectè¿™ä¸ªåŸºç±»æä¾›äº†ä¸¤ç§å†…å­˜åˆ†é…çš„æ–¹æ³•ï¼š<code>+(id)alloc</code> å’Œ <code>+(id)allocWithZone:(NSZone *)aZone</code>ï¼Œè¿™ä¸¤ä¸ªæ–¹æ³•åœ¨è¢«ç»§æ‰¿çš„å¯¹è±¡ä¸­å‡ ä¹ä»ä¸è¢«é‡å†™ã€‚<code>+(id)alloc</code> å…¶å®ä¹Ÿæ˜¯è°ƒç”¨äº† <code>+(id)allocWithZone:(NSZone *)aZone</code> ä¼ å…¥äº†ä¸€ä¸ªé»˜è®¤çš„zoneå‚æ•°ï¼ˆç­‰ä¸‹æˆ‘ä»¬å†è¯¦ç»†è¯´ä¸‹zoneï¼‰ã€‚è¿™ä¸¤ä¸ªæ–¹æ³•ä¼šè¿”å›ä¸€ä¸ªæŒ‡å‘ä¸€ä¸ªé‡æ–°åˆ†é…çš„å†…å­˜å—çš„æŒ‡é’ˆå¹¶ä¸”åšäº†ä¸‹é¢å‡ ä»¶äº‹æƒ…ï¼š</p>
<ol>
<li>æŠŠå¯¹è±¡çš„retain countè®¾ä¸º1.</li>
<li>æŠŠå¯¹è±¡çš„isaå˜é‡æŒ‡å‘å¯¹è±¡çš„class</li>
<li>åˆå§‹åŒ–æ‰€æœ‰çš„æˆå‘˜å˜é‡ä¸ºé»˜è®¤å€¼ï¼ˆ0ã€nilï¼Œ0.0 etc.ï¼‰</li>
</ol>
<p>####Zones</p>
<p>è¿™ä¸ªä»å¤´è¯´èµ·ï¼Œæ¯ä¸€ä¸ªCocoaçš„åº”ç”¨éƒ½æœ‰å¤§é‡çš„å¯å¯»å€å†…å­˜ã€‚</p>
<p>å½“è®¾å¤‡ä¸Šæ‰€æœ‰ç‰©ç†å†…å­˜éƒ½è¢«å ç”¨äº†ï¼Œè¿™æ—¶æœ‰åº”ç”¨è¿˜åœ¨åŠ¨æ€çš„å‘æ“ä½œç³»ç»Ÿç”³è¯·å†…å­˜ã€‚è¿™ä¸ªæ—¶å€™ï¼Œæ“ä½œç³»ç»Ÿå°±ä¼šæŠŠå†…å­˜ä¸­çš„ä¸€äº›å†…å®¹æ‹·åˆ°ç¡¬ç›˜ï¼ˆswappingï¼‰ä¸Šä»è€Œé‡Šæ”¾å‡ºä¸€éƒ¨åˆ†å†…å­˜æ¥æ»¡è¶³è¿™ä¸ªè¦æ±‚ã€‚</p>
<p>ç„¶ååº”ç”¨è¿è¡Œçš„è¿‡ç¨‹ä¸­è¦éœ€è¦ç”¨åˆ°æ‹·åˆ°ç¡¬ç›˜ä¸Šå»çš„é‚£éƒ¨åˆ†æ•°æ®äº†ï¼Œæ“ä½œç³»ç»Ÿåˆä¼šæŠŠå†…å­˜ä¸­å¦å¤–ä¸€å—å†…å®¹æ‹·åˆ°ç¡¬ç›˜ä¸Šï¼Œç„¶åæŠŠä¹‹å‰æ‹·å‡ºå»çš„æ¢å›æ¥ä¾›åº”ç”¨ä½¿ç”¨ã€‚</p>
<p>ç”±äºè¿™æ ·çš„æ“ä½œæ˜¯æ¯”è¾ƒè€—æ—¶çš„ï¼Œæ‰€ä»¥è¿™æ ·æ“ä½œè¿‡å¤šæ—¶å°±ä¼šé€ æˆæŠ–åŠ¨ï¼ˆthrashingï¼‰ã€‚</p>
<p>å¦‚æœç»å¸¸ä¸€èµ·ä½¿ç”¨çš„ä¸¤ä¸ªobjectå­˜åœ¨å†…å­˜ä¸­æ¯”è¾ƒâ€œè¿œâ€çš„å—ä¸­ï¼Œé‚£ä¹ˆé€ æˆæŠ–åŠ¨çš„æœºä¼šå°±ä¼šå¤§å¤§çš„å¢åŠ ã€‚</p>
<p>è€ƒè™‘ä¸€ä¸‹è¿™ç§æƒ…å†µï¼š</p>
<ol>
<li>åº”ç”¨éœ€è¦ä½¿ç”¨åˆ°çš„å…¶ä¸­ä¸€ä¸ªobjectä¸åœ¨å†…å­˜ä¸­ï¼Œè¿™ä¸ªæ—¶å€™å°±éœ€è¦æŠŠç¡¬ç›˜ä¸­çš„å—å„¿æ¢å›æ¥ã€‚</li>
<li>æ¢å›æ¥ä¹‹åï¼Œå‘ç°è¿™ä¸ªobjectè¦è®¿é—®çš„å¦å¤–ä¸€ä¸ªobjectåˆä¸åœ¨å†…å­˜ä¸­ã€‚</li>
<li>è¿™æ—¶å°±éœ€è¦è¿™æ—¶å°±éœ€è¦ç»§ç»­ä»ç¡¬ç›˜ä¸­æ¢å›æ•°æ®ã€‚</li>
<li>æœ€åçš„æƒ…å†µå°±æ˜¯ï¼Œæ¢ç¬¬äºŒéƒ¨åˆ†çš„æ—¶å€™åˆæŠŠç¬¬ä¸€æ¬¡çš„ç»™æ¢å‡ºå»äº†ã€‚</li>
</ol>
<p>OKï¼Œé‚£ä¹ˆzoneå°±æ˜¯ç”¨æ¥ä¿è¯éœ€è¦ä¸€èµ·ä½¿ç”¨çš„objectå°½é‡åˆ†é…çš„äº’ç›¸é è¿‘çš„ä½ç½®ï¼Œä¿è¯ï¼Œè¦ä¹ˆéƒ½åœ¨å†…å­˜ä¸­ï¼Œè¦ä¹ˆéƒ½åœ¨ç¡¬ç›˜ä¸­ï¼Œé¿å…ä¸Šé¢çš„æƒ…å†µå‘ç”Ÿã€‚</p>
<p>ä¸è¿‡åœ¨OS X 10.5çš„Object-C 2.0ä¹‹åï¼Œå¦‚æœä½ ä½¿ç”¨äº†ARCï¼Œé‚£ä¹ˆ<code>allocWithZone:</code>çš„zoneå‚æ•°å°†è¢«å¿½ç•¥ï¼ŒAppleä¸åœ¨é¼“åŠ±ä½¿ç”¨è¿™ä¸ªæ–¹æ³•ï¼Œè¿™äº›æ“ä½œå°†é»˜è®¤æœ‰Cocoaæ¥å®ç°ã€‚</p>
<p>###init</p>
<p>å½“å†…å­˜åˆ†é…å®Œæˆä¹‹åï¼Œå°±è¦è°ƒç”¨objectçš„å®ä¾‹æ–¹æ³•è¿›è¡Œåˆå§‹åŒ–äº†ã€‚è¿™äº›åˆå§‹åŒ–æ–¹æ³•é€šå¸¸ä»¥<code>init</code>å¼€å¤´ï¼Œè¿”å›å€¼ä¸º<code>id</code>ç±»å‹ã€‚</p>
<ul>
<li>ä¸€ä¸ªå¯¹è±¡å¯ä»¥æœ‰å¾ˆå¤šåˆå§‹åŒ–æ–¹æ³•ï¼Œæ¯ä¸€ä¸ªåˆå§‹åŒ–æ–¹æ³•å¯ä»¥å¸¦ä¸åŒçš„å‚æ•°ï¼Œé€šå¸¸å…¶ä¸­æœ‰ä¸€ä¸ªåˆå§‹åŒ–æ–¹æ³•ä¼šä½œä¸ºä¸ºå¯¹è±¡çš„æŒ‡å®šåˆå§‹åŒ–æ–¹æ³•(The Designated Initializer)ã€‚æ¯”å¦‚NSObjectçš„æŒ‡å®šåˆå§‹åŒ–æ–¹æ³•æ˜¯<code>-(id)init</code>ï¼ŒUIViewçš„é»˜è®¤åˆå§‹åŒ–æ–¹æ³•æ˜¯<code>-(id)initWithFrame:(CGRect)frame</code>ã€‚</li>
<li>ä»»ä½•ä¸€ä¸ªåˆå§‹åŒ–æ–¹æ³•éƒ½å¯ä»¥æˆä¸ºæŒ‡å®šçš„åˆå§‹åŒ–æ–¹æ³•ï¼Œä½†æ˜¯å¿…é¡»è¦æ˜ç¡®çš„è¯´æ˜ã€‚</li>
<li>ä¸€èˆ¬æƒ…å†µä¸‹ï¼ŒæŒ‡å®šçš„åˆå§‹åŒ–æ–¹æ³•æ˜¯é‚£ä¸ªå¸¦å‚æ•°æœ€å¤šçš„åˆå§‹åŒ–æ–¹æ³•ã€‚</li>
<li>å…¶ä»–çš„åˆå§‹åŒ–æ–¹æ³•é€šè¿‡è°ƒç”¨æŒ‡å®šçš„åˆå§‹åŒ–æ–¹æ³•æ¥å®ç°ã€‚</li>
</ul>
<p>çœ‹ä¸‹é¢çš„ä¾‹å­ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">MYCircle</span> : <span class="title">NSObject</span></span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="built_in">NSPoint</span> center;</span><br><span class="line">	<span class="keyword">float</span> radius;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Designated Initializer</span></span><br><span class="line">- (<span class="keyword">id</span>)initWithCenter:(<span class="built_in">NSPoint</span>)aPoint radius:(<span class="keyword">float</span>)aRadius;</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">MYCircle</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Designated Initializer</span></span><br><span class="line">- (<span class="keyword">id</span>)initWithCenter:(<span class="built_in">NSPoint</span>)aPoint radius:(<span class="keyword">float</span>)aRadius</span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">self</span> = [<span class="keyword">super</span> init];</span><br><span class="line">	<span class="keyword">if</span>(<span class="literal">nil</span> != <span class="keyword">self</span>) &#123;</span><br><span class="line">		center = aPoint;</span><br><span class="line">		radius = aRadius;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œçš„<code>self=[super init]</code>æ˜¯è‡³å…³é‡è¦çš„ä¸€æ­¥ã€‚</p>
<ol>
<li><code>[super init]</code>å¯èƒ½ä¼šå¤±è´¥ï¼Œå¦‚æœå¤±è´¥äº†ï¼Œæ¥ä¸‹æ¥å¦‚æœç»§ç»­æ“ä½œçš„è¯æ˜¯ä¸å¯é¢„æœŸçš„ã€‚</li>
<li>superå¯èƒ½ä¼šé‡æ–°+allocç„¶åè¿”å›ä¸€ä¸ªè·Ÿselfå®Œå…¨ä¸åŒçš„objectï¼Œè¿™ç§æƒ…å†µä¸‹æ¥ä¸‹æ¥çš„æ“ä½œä¹Ÿæ˜¯æœ‰é—®é¢˜çš„ã€‚</li>
</ol>
<p>å›åˆ°åˆšæ‰çš„é—®é¢˜ï¼Œåœ¨è¿™ä¸ªä¾‹å­ä¸­<code>- (id)initWithCenter:(NSPoint)aPoint radius:(float)aRadius;</code>è¢«æ ‡è®°ä¸ºæŒ‡å®šçš„åˆå§‹åŒ–æ–¹æ³•ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œåº”è¯¥é‡å†™ç»§æ‰¿çš„çˆ¶ç±»çš„æŒ‡å®šåˆå§‹åŒ–æ–¹æ³•<code>-(id)init</code> (é€šè¿‡<code>NS_DESIGNATED_INITIALIZER</code>æ ‡è®°)</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">id</span>)init</span><br><span class="line"><span class="comment">// Overriden inherited Designated Initializer - (id)init</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">float</span> MYDefaultRadius = <span class="number">1.0</span>f;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// call Designated Initializer with default arguments</span></span><br><span class="line">	<span class="keyword">return</span> [<span class="keyword">self</span> initWithCenter:<span class="built_in">NSZeroPoint</span> radius:MYDefaultRadius];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">id</span>)initWithRadius:(<span class="keyword">float</span>)aRadius</span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">return</span> [<span class="keyword">self</span> initWithCenter:<span class="built_in">NSZeroPoint</span> radius:aRadius];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p>åŸºæœ¬ä¸Šè¦éµå¾ªä¸€ä¸‹å‡ ç‚¹ï¼š</p>
<ol>
<li>ç¡®ä¿æŒ‡å®šåˆå§‹åŒ–æ–¹æ³•è¦è°ƒç”¨çˆ¶ç±»çš„æŒ‡å®šåˆå§‹åŒ–æ–¹æ³•ã€‚</li>
<li>æŠŠçˆ¶ç±»çš„åˆ¶å®šåˆå§‹åŒ–æ–¹æ³•çš„è¿”å›å€¼èµ‹ç»™selfã€‚</li>
<li>å¦‚æœçˆ¶ç±»çš„æŒ‡å®šåˆå§‹åŒ–è¿”å›ä¸ºnilæ—¶ï¼Œä¸è¦ç»§ç»­å»æ“ä½œç¤ºä¾‹å˜é‡äº†ã€‚</li>
<li>å¦‚æœæ ‡è®°äº†æ–°çš„æŒ‡å®šåˆå§‹åŒ–æ–¹æ³•ï¼Œé‚£ä¹ˆä¸€å®šè¦é‡å†™æ‰€ç»§æ‰¿çš„çˆ¶ç±»çš„æŒ‡å®šåˆå§‹åŒ–æ–¹æ³•ï¼ˆä¾‹å­æ€»çš„initï¼‰ã€‚</li>
<li>ç»§æ‰¿çš„æ—¶å€™ï¼Œç¡®ä¿æ¯ä¸€ä¸ªåˆå§‹åŒ–æ–¹æ³•ï¼Œå¦‚æœæœ¬èº«ä¸æ˜¯æŒ‡å®šåˆå§‹åŒ–æ–¹æ³•ï¼Œé‚£ä¹ˆå°±è¦è°ƒç”¨æŒ‡å®šåˆå§‹åŒ–æ–¹æ³•å»å®ç°ã€‚</li>
</ol>
<p>###Creating Temporary Instances</p>
<p>ä¸´æ—¶å˜é‡çš„åˆ›å»ºå°±æ˜¯æŠŠallocå’Œinitåˆå¹¶åˆ°ä¸€èµ·ç„¶åè¿”å›ä¸€ä¸ªä¸´æ—¶çš„å®ä¾‹å¯¹è±¡ã€‚</p>
<p>MRCæƒ…å†µä¸‹ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">+ (<span class="keyword">id</span>)stringWithString:(<span class="built_in">NSString</span> *)aString</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">return</span> [[[<span class="keyword">self</span> alloc] initWithString:aString] autorelease];</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ARCæƒ…å†µä¸‹ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">+ (<span class="keyword">id</span>)stringWithString:(<span class="built_in">NSString</span> *)aString</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">return</span> [[<span class="keyword">self</span> alloc] initWithString:aString];</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™æ ·åœ¨åˆ›å»ºå’Œä½¿ç”¨ä¸´æ—¶å®ä¾‹çš„æ—¶å€™å°±éå¸¸æ–¹ä¾¿äº†ã€‚</p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2016/10/21/add-infomation-on-app-icon/">ã€è¯‘ã€‘åœ¨åº”ç”¨çš„iconä¸ŠåŠ ä¸Šç¼–è¯‘ç›¸å…³ä¿¡æ¯</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2016-10-21</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/Objective-C/">Objective-C</a></span><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/iOS/">iOS</a></span><div class="content"><p>#####åŠ é‚£äº›ä¿¡æ¯</p>
<ul>
<li>ç‰ˆæœ¬å·</li>
<li>ä»£ç åˆ†æ”¯åå­—</li>
<li>æœ€åä¸€æ¬¡commitçš„hashå€¼</li>
</ul>
<p>######ç‰ˆæœ¬å·<br>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨PlistBuddyå·¥å…·ç›´æ¥ä»é¡¹ç›®æ–‡ä»¶info.plistä¸­å–å‡ºç‰ˆæœ¬å·</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">version&#x3D;&#96;&#x2F;usr&#x2F;libexec&#x2F;PlistBuddy -c &quot;Print CFBundleVersion&quot; &quot;$&#123;INFOPLIST_FILE&#125;&quot;&#96;</span><br></pre></td></tr></table></figure>
<p>(å½“ç„¶äº†ï¼Œä½ å¯ä»¥é€šè¿‡è¿™ä¸ªå·¥å…·å–å‡ºinfo.plistä¸­çš„ä»»ä½•å€¼ï¼ŒæŠŠCFBundleVersionæ”¹ä¸ºå…¶ä»–çš„keyå°±è¡Œäº†ï¼Œkeyå€¼å¯ä»¥åœ¨xcodeä¸­æŸ¥çœ‹)</p>
<p>######ä»£ç åˆ†æ”¯åå­—å’Œcommitçš„hashå€¼<br>è¿™ä¸¤ä¸ªå€¼æˆ‘ä»¬å¯ä»¥é€šè¿‡gitçš„å‘½ä»¤è¡Œ<code>git rev-parse</code>æ¥è·å–</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">commit&#x3D;&#96;git rev-parse --short HEAD&#96;</span><br><span class="line">branch&#x3D;&#96;git rev-parse --abbrev-ref HEAD&#96;</span><br></pre></td></tr></table></figure>

<p>######æ€ä¹ˆæŠŠè¿™äº›ä¿¡æ¯æ”¾åˆ°iconä¸Šå»ï¼Ÿ<br>ImageMagicæ˜¯ä¸€ä¸ªæ“ä½œå›¾ç‰‡çš„å‘½ä»¤è¡Œå·¥å…·ï¼Œè¿™ä¸ªå·¥å…·æœ‰ä¸€å †ç‰›é€¼çš„åŠŸèƒ½</p>
<p>é¦–å…ˆè¦å®‰è£…ImageMagickå’Œghostscriptï¼ˆfontsï¼‰å·¥å…·ï¼Œå¯ä»¥ä½¿ç”¨brewæ¥å¿«é€Ÿå®‰è£…</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">brew install imagemagick</span><br><span class="line">brew install ghostscript</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨convertå·¥å…·ï¼Œé€šè¿‡é…ç½®imagemagicçš„captionå‚æ•°æŠŠè¿™äº›æ–‡å­—ä¿¡æ¯æ”¾åˆ°iconä¸Šï¼Œé¡ºä¾¿è®¾ç½®åº•éƒ¨å¯¹é½ä»¥åŠé»˜è®¤é«˜åº¦ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">convert -background &#39;#0008&#39; -fill white -gravity center -size $&#123;width&#125;x40 \</span><br><span class="line">    caption:&quot;$&#123;version&#125; $&#123;branch&#125; $&#123;commit&#125;&quot; \</span><br><span class="line">    $&#123;base_file&#125; +swap -gravity south -composite  &quot;$&#123;CONFIGURATION_BUILD_DIR&#125;&#x2F;$&#123;UNLOCALIZED_RESOURCES_FOLDER_PATH&#125;&#x2F;$&#123;target_file&#125;&quot;</span><br></pre></td></tr></table></figure>
<p>#####xcode é¡¹ç›®çš„é…ç½®<br>é€šè¿‡å‡ éƒ¨ç®€å•çš„é…ç½®æŠŠè¿™äº›æ­¥éª¤åŠ åˆ°xcodeç¼–è¯‘ä¸­</p>
<ol>
<li>æŠŠé¡¹ç›®ä¸­çš„Iconçš„æ–‡ä»¶åIcon<em>æ”¹ä¸ºIcon_base</em>(Icon@2x.png to <a href="mailto:Icon@2x_base.png">Icon@2x_base.png</a>)</li>
<li>åœ¨ç¼–è¯‘ç›®æ ‡çš„build phaseä¸­æ·»åŠ ä¸‹é¢çš„è„šæœ¬ï¼š<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">commit&#x3D;&#96;git rev-parse --short HEAD&#96;</span><br><span class="line">branch&#x3D;&#96;git rev-parse --abbrev-ref HEAD&#96;</span><br><span class="line">version&#x3D;&#96;&#x2F;usr&#x2F;libexec&#x2F;PlistBuddy -c &quot;Print CFBundleVersion&quot; &quot;$&#123;INFOPLIST_FILE&#125;&quot;&#96;</span><br><span class="line"></span><br><span class="line">function processIcon() &#123;</span><br><span class="line">    export PATH&#x3D;$PATH:&#x2F;usr&#x2F;local&#x2F;bin</span><br><span class="line">    base_file&#x3D;$1</span><br><span class="line">    base_path&#x3D;&#96;find $&#123;SRCROOT&#125; -name $base_file&#96;</span><br><span class="line"></span><br><span class="line">    if [[ ! -f $&#123;base_path&#125; || -z $&#123;base_path&#125; ]]; then</span><br><span class="line">        return;</span><br><span class="line">    fi</span><br><span class="line"></span><br><span class="line">    target_file&#x3D;&#96;echo $base_file | sed &quot;s&#x2F;_base&#x2F;&#x2F;&quot;&#96;</span><br><span class="line">    target_path&#x3D;&quot;$&#123;CONFIGURATION_BUILD_DIR&#125;&#x2F;$&#123;UNLOCALIZED_RESOURCES_FOLDER_PATH&#125;&#x2F;$&#123;target_file&#125;&quot;</span><br><span class="line"></span><br><span class="line">    if [ $CONFIGURATION &#x3D; &quot;Release&quot; ]; then</span><br><span class="line">    cp $&#123;base_file&#125; $target_path</span><br><span class="line">    return</span><br><span class="line">    fi</span><br><span class="line"></span><br><span class="line">    width&#x3D;&#96;identify -format %w $&#123;base_path&#125;&#96;</span><br><span class="line"></span><br><span class="line">    convert -background &#39;#0008&#39; -fill white -gravity center -size $&#123;width&#125;x40\</span><br><span class="line">    caption:&quot;$&#123;version&#125; $&#123;branch&#125; $&#123;commit&#125;&quot;\</span><br><span class="line">    $&#123;base_path&#125; +swap -gravity south -composite $&#123;target_path&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">processIcon &quot;Icon_base.png&quot;</span><br><span class="line">processIcon &quot;Icon@2x_base.png&quot;</span><br><span class="line">processIcon &quot;Icon-72_base.png&quot;</span><br><span class="line">processIcon &quot;Icon-72@2x_base.png&quot;</span><br></pre></td></tr></table></figure>

</li>
</ol>
<p>#####ç»“å°¾</p>
<p>å…³äºè¿™ä¸ªè„šæœ¬çš„å‡ ä¸ªå°ç‚¹ï¼š</p>
<ol>
<li>è‡ªåŠ¨è·³è¿‡ä¸å­˜åœ¨çš„iconæ–‡ä»¶</li>
<li>é€šè¿‡sedå»æ‰æ–‡ä»¶åæœ«å°¾çš„_baseå­—ç¬¦ä¸²</li>
<li>releaseç‰ˆæœ¬åˆ™ä¸ä¼šæ·»åŠ è¿™äº›ä¿¡æ¯åˆ°iconä¸Š</li>
<li>xcodeè²Œä¼¼å§pathä¿¡æ¯å¼„ä¹±äº†ï¼Œæ‰€ä»¥åœ¨è¿™ä¸ªè„šæœ¬ä½¿ç”¨ä¸­æ·»åŠ äº†<code>usr/local/bin</code>è·¯å¾„</li>
</ol>
<p><a href="https://github.com/krzysztofzablocki/IconOverlaying" target="_blank" rel="noopener">è„šæœ¬å’Œä¾‹å­çœ‹è¿™é‡Œ</a></p>
<p>åŸæ–‡åœ°å€ï¼š<a href="http://merowing.info/2013/03/overlaying-application-version-on-top-of-your-icon/" target="_blank" rel="noopener">http://merowing.info/2013/03/overlaying-application-version-on-top-of-your-icon/</a></p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2015/12/30/ffmpeg-commands/">ffmpegå¸¸ç”¨åŸºæœ¬å‘½ä»¤[æ•´ç†]</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2015-12-30</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/ffmpeg/">ffmpeg</a></span><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/ffmpeg/">ffmpeg</a></span><div class="content"><p>ä¸»è¦å‚æ•°ï¼š -i è®¾å®šè¾“å…¥æµ -f è®¾å®šè¾“å‡ºæ ¼å¼ -ss å¼€å§‹æ—¶é—´ è§†é¢‘å‚æ•°ï¼š -b è®¾å®šè§†é¢‘æµé‡ï¼Œé»˜è®¤ä¸º200Kbit/s -r è®¾å®šå¸§é€Ÿç‡ï¼Œé»˜è®¤ä¸º25 -s è®¾å®šç”»é¢çš„å®½ä¸é«˜ -aspect è®¾å®šç”»é¢çš„æ¯”ä¾‹ -vn ä¸å¤„ç†è§†é¢‘ -vcodec è®¾å®šè§†é¢‘ç¼–è§£ç å™¨ï¼Œæœªè®¾å®šæ—¶åˆ™ä½¿ç”¨ä¸è¾“å…¥æµç›¸åŒçš„ç¼–è§£ç å™¨ éŸ³é¢‘å‚æ•°ï¼š -ar è®¾å®šé‡‡æ ·ç‡ -ac è®¾å®šå£°éŸ³çš„Channelæ•° -acodec è®¾å®šå£°éŸ³ç¼–è§£ç å™¨ï¼Œæœªè®¾å®šæ—¶åˆ™ä½¿ç”¨ä¸è¾“å…¥æµç›¸åŒçš„ç¼–è§£ç å™¨ -an ä¸å¤„ç†éŸ³é¢‘</p>
<p>1.åˆ†ç¦»è§†é¢‘éŸ³é¢‘æµ</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ffmpeg -i input_file -vcodec copy -an output_file_videoã€€ã€€&#x2F;&#x2F;åˆ†ç¦»è§†é¢‘æµ</span><br><span class="line">ffmpeg -i input_file -acodec copy -vn output_file_audioã€€ã€€&#x2F;&#x2F;åˆ†ç¦»éŸ³é¢‘æµ</span><br></pre></td></tr></table></figure>
<p>2.è§†é¢‘è§£å¤ç”¨</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ffmpeg â€“i test.mp4 â€“vcodec copy â€“an â€“f m4v test.264</span><br><span class="line">ffmpeg â€“i test.avi â€“vcodec copy â€“an â€“f m4v test.264</span><br></pre></td></tr></table></figure>
<p>3.è§†é¢‘è½¬ç </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ffmpeg â€“i test.mp4 â€“vcodec h264 â€“s 352*278 â€“an â€“f m4v test.264              &#x2F;&#x2F;è½¬ç ä¸ºç æµåŸå§‹æ–‡ä»¶</span><br><span class="line">ffmpeg â€“i test.mp4 â€“vcodec h264 â€“bf 0 â€“g 25 â€“s 352*278 â€“an â€“f m4v test.264  &#x2F;&#x2F;è½¬ç ä¸ºç æµåŸå§‹æ–‡ä»¶</span><br><span class="line">ffmpeg â€“i test.avi -vcodec mpeg4 â€“vtag xvid â€“qsame test_xvid.avi            &#x2F;&#x2F;è½¬ç ä¸ºå°è£…æ–‡ä»¶</span><br><span class="line">&#x2F;&#x2F;-bf Bå¸§æ•°ç›®æ§åˆ¶ï¼Œ-g å…³é”®å¸§é—´éš”æ§åˆ¶ï¼Œ-s åˆ†è¾¨ç‡æ§åˆ¶</span><br></pre></td></tr></table></figure>
<p>4.è§†é¢‘å°è£…</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ffmpeg â€“i video_file â€“i audio_file â€“vcodec copy â€“acodec copy output_file</span><br></pre></td></tr></table></figure>
<p>5.è§†é¢‘å‰ªåˆ‡</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ffmpeg â€“i test.avi â€“r 1 â€“f image2 image-%3d.jpeg        &#x2F;&#x2F;æå–å›¾ç‰‡</span><br><span class="line">ffmpeg -ss 0:1:30 -t 0:0:20 -i input.avi -vcodec copy -acodec copy output.avi    &#x2F;&#x2F;å‰ªåˆ‡è§†é¢‘</span><br><span class="line">&#x2F;&#x2F;-r æå–å›¾åƒçš„é¢‘ç‡ï¼Œ-ss å¼€å§‹æ—¶é—´ï¼Œ-t æŒç»­æ—¶é—´</span><br></pre></td></tr></table></figure>
<p>6.è§†é¢‘å½•åˆ¶</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ffmpeg â€“i rtsp:&#x2F;&#x2F;192.168.3.205:5555&#x2F;test â€“vcodec copy out.avi</span><br></pre></td></tr></table></figure>
<p>7.YUVåºåˆ—æ’­æ”¾</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ffplay -f rawvideo -video_size 1920x1080 input.yuv</span><br></pre></td></tr></table></figure>
<p>8.YUVåºåˆ—è½¬AVI</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ffmpeg â€“s w*h â€“pix_fmt yuv420p â€“i input.yuv â€“vcodec mpeg4 output.avi</span><br></pre></td></tr></table></figure>

<p><strong>æµåª’ä½“ç›¸å…³åº”ç”¨:</strong></p>
<p>1ã€å°†æ–‡ä»¶å½“åšç›´æ’­é€è‡³live</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ffmpeg -re -i localFile.mp4 -c copy -f flv rtmp:&#x2F;&#x2F;server&#x2F;live&#x2F;streamName</span><br></pre></td></tr></table></figure>
<p>2ã€å°†ç›´æ’­åª’ä½“ä¿å­˜è‡³æœ¬åœ°æ–‡ä»¶</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ffmpeg -i rtmp:&#x2F;&#x2F;server&#x2F;live&#x2F;streamName -c copy dump.flv</span><br></pre></td></tr></table></figure>
<p>3ã€å°†å…¶ä¸­ä¸€ä¸ªç›´æ’­æµï¼Œè§†é¢‘æ”¹ç”¨h264å‹ç¼©ï¼ŒéŸ³é¢‘ä¸å˜ï¼Œé€è‡³å¦å¤–ä¸€ä¸ªç›´æ’­æœåŠ¡æµ</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ffmpeg -i rtmp:&#x2F;&#x2F;server&#x2F;live&#x2F;originalStream -c:a copy -c:v libx264 -vpre slow -f flv rtmp:&#x2F;&#x2F;server&#x2F;live&#x2F;h264Stream</span><br></pre></td></tr></table></figure>
<p>4ã€å°†å…¶ä¸­ä¸€ä¸ªç›´æ’­æµï¼Œè§†é¢‘æ”¹ç”¨h264å‹ç¼©ï¼ŒéŸ³é¢‘æ”¹ç”¨faacå‹ç¼©ï¼Œé€è‡³å¦å¤–ä¸€ä¸ªç›´æ’­æœåŠ¡æµ</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ffmpeg -i rtmp:&#x2F;&#x2F;server&#x2F;live&#x2F;originalStream -c:a libfaac -ar 44100 -ab 48k -c:v libx264 -vpre slow -vpre baseline -f flv rtmp:&#x2F;&#x2F;server&#x2F;live&#x2F;h264Stream</span><br></pre></td></tr></table></figure>
<p>5ã€å°†å…¶ä¸­ä¸€ä¸ªç›´æ’­æµï¼Œè§†é¢‘ä¸å˜ï¼ŒéŸ³é¢‘æ”¹ç”¨faacå‹ç¼©ï¼Œé€è‡³å¦å¤–ä¸€ä¸ªç›´æ’­æœåŠ¡æµ</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ffmpeg -i rtmp:&#x2F;&#x2F;server&#x2F;live&#x2F;originalStream -acodec libfaac -ar 44100 -ab 48k -vcodec copy -f flv rtmp:&#x2F;&#x2F;server&#x2F;live&#x2F;h264_AAC_Stream</span><br></pre></td></tr></table></figure>
<p>6ã€å°†ä¸€ä¸ªé«˜æ¸…æµï¼Œå¤åˆ¶ä¸ºå‡ ä¸ªä¸åŒè§†é¢‘æ¸…æ™°åº¦çš„æµé‡æ–°å‘å¸ƒï¼Œå…¶ä¸­éŸ³é¢‘ä¸å˜</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ffmpeg -re -i rtmp:&#x2F;&#x2F;server&#x2F;live&#x2F;high_FMLE_stream -acodec copy -vcodec x264lib -s 640Ã—360 -b 500k -vpre medium -vpre baseline rtmp:&#x2F;&#x2F;server&#x2F;live&#x2F;baseline_500k -acodec copy -vcodec x264lib -s 480Ã—272 -b 300k -vpre medium -vpre baseline rtmp:&#x2F;&#x2F;server&#x2F;live&#x2F;baseline_300k -acodec copy -vcodec x264lib -s 320Ã—200 -b 150k -vpre medium -vpre baseline rtmp:&#x2F;&#x2F;server&#x2F;live&#x2F;baseline_150k -acodec libfaac -vn -ab 48k rtmp:&#x2F;&#x2F;server&#x2F;live&#x2F;audio_only_AAC_48k</span><br></pre></td></tr></table></figure>
<p>7ã€åŠŸèƒ½ä¸€æ ·ï¼Œåªæ˜¯é‡‡ç”¨-x264optsé€‰é¡¹</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ffmpeg -re -i rtmp:&#x2F;&#x2F;server&#x2F;live&#x2F;high_FMLE_stream -c:a copy -c:v x264lib -s 640Ã—360 -x264opts bitrate&#x3D;500:profile&#x3D;baseline:preset&#x3D;slow rtmp:&#x2F;&#x2F;server&#x2F;live&#x2F;baseline_500k -c:a copy -c:v x264lib -s 480Ã—272 -x264opts bitrate&#x3D;300:profile&#x3D;baseline:preset&#x3D;slow rtmp:&#x2F;&#x2F;server&#x2F;live&#x2F;baseline_300k -c:a copy -c:v x264lib -s 320Ã—200 -x264opts bitrate&#x3D;150:profile&#x3D;baseline:preset&#x3D;slow rtmp:&#x2F;&#x2F;server&#x2F;live&#x2F;baseline_150k -c:a libfaac -vn -b:a 48k rtmp:&#x2F;&#x2F;server&#x2F;live&#x2F;audio_only_AAC_48k</span><br></pre></td></tr></table></figure>
<p>8ã€å°†å½“å‰æ‘„åƒå¤´åŠéŸ³é¢‘é€šè¿‡DSSHOWé‡‡é›†ï¼Œè§†é¢‘h264ã€éŸ³é¢‘faacå‹ç¼©åå‘å¸ƒ</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ffmpeg -r 25 -f dshow -s 640Ã—480 -i video&#x3D;â€video source nameâ€:audio&#x3D;â€audio source nameâ€ -vcodec libx264 -b 600k -vpre slow -acodec libfaac -ab 128k -f flv rtmp:&#x2F;&#x2F;server&#x2F;application&#x2F;stream_name</span><br></pre></td></tr></table></figure>
<p>9ã€å°†ä¸€ä¸ªJPGå›¾ç‰‡ç»è¿‡h264å‹ç¼©å¾ªç¯è¾“å‡ºä¸ºmp4è§†é¢‘</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ffmpeg -i INPUT.jpg -an -vcodec libx264 -coder 1 -flags +loop -cmp +chroma -subq 10 -qcomp 0.6 -qmin 10 -qmax 51 -qdiff 4 -flags2 +dct8x8 -trellis 2 -partitions +parti8x8+parti4x4 -crf 24 -threads 0 -r 25 -g 25 -y OUTPUT.mp4</span><br></pre></td></tr></table></figure>
<p>10ã€å°†æ™®é€šæµè§†é¢‘æ”¹ç”¨h264å‹ç¼©ï¼ŒéŸ³é¢‘ä¸å˜ï¼Œé€è‡³é«˜æ¸…æµæœåŠ¡(æ–°ç‰ˆæœ¬FMS live=1)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ffmpeg -i rtmp:&#x2F;&#x2F;server&#x2F;live&#x2F;originalStream -c:a copy -c:v libx264 -vpre slow -f flv â€œrtmp:&#x2F;&#x2F;server&#x2F;live&#x2F;h264Stream live&#x3D;1ã€ƒ</span><br></pre></td></tr></table></figure>

<p><strong>è§†é¢‘é‡‡é›†ç›¸å…³:</strong></p>
<p>1.é‡‡é›†usbæ‘„åƒå¤´è§†é¢‘å‘½ä»¤ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ffmpeg -t 20 -f vfwcap -i 0 -r 8 -f mp4 cap1111.mp4</span><br><span class="line"></span><br><span class="line">.&#x2F;ffmpeg -t 10 -f vfwcap -i 0 -r 8 -f mp4 cap.mp4</span><br><span class="line"></span><br><span class="line">å…·ä½“è¯´æ˜å¦‚ä¸‹ï¼šæˆ‘ä»¬é‡‡é›†10ç§’ï¼Œé‡‡é›†è®¾å¤‡ä¸ºvfwcapç±»å‹è®¾å¤‡ï¼Œç¬¬0ä¸ªvfwcapé‡‡é›†è®¾å¤‡ï¼ˆå¦‚æœç³»ç»Ÿæœ‰å¤šä¸ªvfwçš„è§†é¢‘é‡‡é›†è®¾å¤‡ï¼Œå¯ä»¥é€šè¿‡-i numæ¥é€‰æ‹©ï¼‰ï¼Œæ¯ç§’8å¸§ï¼Œè¾“å‡ºæ–¹å¼ä¸ºæ–‡ä»¶ï¼Œæ ¼å¼ä¸ºmp4ã€‚</span><br></pre></td></tr></table></figure>
<p>2.æœ€ç®€å•çš„æŠ“å±ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ffmpeg -f gdigrab -i desktop out.mpg</span><br></pre></td></tr></table></figure>
<p>3.ä»å±å¹•çš„ï¼ˆ10,20ï¼‰ç‚¹å¤„å¼€å§‹ï¼ŒæŠ“å–640x480çš„å±å¹•ï¼Œè®¾å®šå¸§ç‡ä¸º5 ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ffmpeg -f gdigrab -framerate 5 -offset_x 10 -offset_y 20 -video_size 640x480 -i desktop out.mpg</span><br></pre></td></tr></table></figure>
<p>4.ffmpegä»è§†é¢‘ä¸­ç”Ÿæˆgifå›¾ç‰‡ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ffmpeg -i capx.mp4 -t 10 -s 320x240 -pix_fmt rgb24 jidu1.gif</span><br></pre></td></tr></table></figure>
<p>5.ffmpegå°†å›¾ç‰‡è½¬æ¢ä¸ºè§†é¢‘ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;blog.sina.com.cn&#x2F;s&#x2F;blog_40d73279010113c2.html</span><br></pre></td></tr></table></figure>
<p><strong>éŸ³é¢‘è½¬æ¢ï¼š</strong></p>
<p>1.è½¬æ¢amråˆ°mp3ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ffmpeg -i shenhuxi.amr amr2mp3.mp3</span><br></pre></td></tr></table></figure>
<p>2.è½¬æ¢amråˆ°wavï¼š</p>
<p>ffmpeg -acodec libamr_nb -i shenhuxi.amr amr2wav.wav<br>3.è½¬æ¢mp3åˆ°wavï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ffmpeg -i DING.mp3 -f wav test.wav</span><br></pre></td></tr></table></figure>
<p>4.è½¬æ¢wavåˆ°amrï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ffmpeg -i test.wav -acodec libamr_nb -ab 12.2k -ar 8000 -ac 1 wav2amr.amr</span><br></pre></td></tr></table></figure>
<p>5.è½¬æ¢wavåˆ°mp3ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ffmpeg -i test.wav -f mp3 -acodec libmp3lame -y wav2mp3.mp3</span><br></pre></td></tr></table></figure>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2015/12/24/mysql-table-is-read-only/">mysql Table is read only çš„é—®é¢˜</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2015-12-24</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/mysql/">mysql</a></span><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/mysql/">mysql</a></span><div class="content"><p>ä»Šå¤©å¯¼å…¥æ•°æ®åº“é‡åˆ°äº†è¿™ä¸ªé—®é¢˜ï¼Œæ€»ç»“ä¸‹è§£å†³æ–¹æ¡ˆï¼š</p>
<p>1.æ”¹å¯æ‰§è¡Œæƒé™</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod -R 777  &#x2F;var&#x2F;lib&#x2F;mysql&#x2F;ssbc2&#x2F;</span><br></pre></td></tr></table></figure>

<p>2.è¯¥ç”¨æˆ·ç»„</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chown root: -R &#x2F;usr&#x2F;lib&#x2F;mysql&#x2F;ssbc2</span><br></pre></td></tr></table></figure>
<p>3.flush tables</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqladmin -u root -p flush-tables</span><br></pre></td></tr></table></figure>

<p>ok,é—®é¢˜è§£å†³</p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2015/12/24/mysql-server-has-gone-away/">MySQL server has gone away é—®é¢˜</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2015-12-24</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/mysql/">mysql</a></span><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/mysql/">mysql</a></span><div class="content"><p>å¯¼å…¥æ•°æ®é‡åˆ°çš„ï¼š<code>ERROR : (2006, &#39;MySQL server has gone away&#39;)</code> æ„æ€å°±æ˜¯è¿æ¥æ–­å¼€äº†ã€‚</p>
<p>ä¸»è¦çœ‹ä¸‹é¢å‡ ä¸ªå‚æ•°ï¼š</p>
<p>1.æ˜¯å¦é‡å¯è¿‡ï¼Œå¦‚æœuptimeå¤ªçŸ­å°±æ˜¯æœ€è¿‘é‡å¯è¿‡</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [(none)]&gt; show global status like &#39;uptime&#39;;</span><br><span class="line">+---------------+-------+</span><br><span class="line">| Variable_name | Value |</span><br><span class="line">+---------------+-------+</span><br><span class="line">| Uptime        | 68600 |</span><br><span class="line">+---------------+-------+</span><br><span class="line">1 row in set (0.93 sec)</span><br></pre></td></tr></table></figure>
<p>2.æŸ¥çœ‹æ— æ“ä½œå¤šä¹…åä¼šè‡ªåŠ¨å…³é—­</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [(none)]&gt; show global variables like &#39;%timeout&#39;;</span><br><span class="line">+----------------------------+----------+</span><br><span class="line">| Variable_name              | Value    |</span><br><span class="line">+----------------------------+----------+</span><br><span class="line">| connect_timeout            | 10       |</span><br><span class="line">| delayed_insert_timeout     | 300      |</span><br><span class="line">| innodb_lock_wait_timeout   | 50       |</span><br><span class="line">| innodb_rollback_on_timeout | OFF      |</span><br><span class="line">| interactive_timeout        | 28800    |</span><br><span class="line">| lock_wait_timeout          | 31536000 |</span><br><span class="line">| net_read_timeout           | 30       |</span><br><span class="line">| net_write_timeout          | 60       |</span><br><span class="line">| slave_net_timeout          | 3600     |</span><br><span class="line">| thread_pool_idle_timeout   | 60       |</span><br><span class="line">| wait_timeout               | 28800    |</span><br><span class="line">+----------------------------+----------+</span><br><span class="line">11 rows in set (0.01 sec)</span><br></pre></td></tr></table></figure>
<p>å¦‚æœwait_timeoutå¤ªçŸ­å°±åœ¨<code>my.ini</code>æˆ–è€…<code>my.cnf</code>ä¸­ä¿®æ”¹ä¸€ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">wait_timeout&#x3D;2880000</span><br><span class="line">interactive_timeout &#x3D; 2880000</span><br><span class="line">max_allowed_packet &#x3D; 512M</span><br></pre></td></tr></table></figure>

<p>3.è¿›ç¨‹ä¸»åŠ¨killæ‰ï¼Œä¸»è¦å°±æ˜¯è¿™ä¸ªäº†ï¼Œç”±äºæ˜¯å¯¼å…¥æ•°æ®ï¼Œè‚¯å®šå°±æ˜¯è¿™ä¸ª<code>max_allowed_packet</code>å¤ªå°äº†</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [(none)]&gt; show global status like &#39;com_kill&#39;;</span><br><span class="line">+---------------+-------+</span><br><span class="line">| Variable_name | Value |</span><br><span class="line">+---------------+-------+</span><br><span class="line">| Com_kill      | 10    |</span><br><span class="line">+---------------+-------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line">MariaDB [(none)]&gt; show global variables like &#39;max_allowed_packet&#39;;</span><br><span class="line">+--------------------+---------+</span><br><span class="line">| Variable_name      | Value   |</span><br><span class="line">+--------------------+---------+</span><br><span class="line">| max_allowed_packet | 1048576 |</span><br><span class="line">+--------------------+---------+</span><br><span class="line">1 row in set (0.01 sec)</span><br></pre></td></tr></table></figure>

<p>é‚£å°±è®¾ç½®å¤§ä¸€ç‚¹å„¿å°±è¡Œäº†ï¼Œè¿™ä¸ªä¹Ÿå¯ä»¥åœ¨ä¸Šé¢çš„é‚£ä¸ªæ–‡ä»¶é‡Œä¿®æ”¹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [(none)]&gt; set global max_allowed_packet&#x3D;1024*1024*16;</span><br><span class="line">Query OK, 0 rows affected (0.03 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; show global variables like &#39;max_allowed_packet&#39;;</span><br><span class="line">+--------------------+----------+</span><br><span class="line">| Variable_name      | Value    |</span><br><span class="line">+--------------------+----------+</span><br><span class="line">| max_allowed_packet | 16777216 |</span><br><span class="line">+--------------------+----------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>
</div><hr></div><nav id="pagination"><div class="pagination"><span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-chevron-right"></i></a></div></nav></div></div><footer><div class="layout" id="footer"><div class="copyright">&copy;2013 - 2020 By y500</div><div class="framework-info"><span>Driven - </span><a href="http://hexo.io" target="_blank" rel="noopener"><span>Hexo</span></a><span class="footer-separator">|</span><span>Theme - </span><a href="https://github.com/Molunerfinn/hexo-theme-melody" target="_blank" rel="noopener"><span>Melody</span></a></div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_site_uv"><i class="fa fa-user"></i><span id="busuanzi_value_site_uv"></span><span></span></span><span class="footer-separator">|</span><span id="busuanzi_container_site_pv"><i class="fa fa-eye"></i><span id="busuanzi_value_site_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.7.0"></script><script src="/js/fancybox.js?version=1.7.0"></script><script src="/js/sidebar.js?version=1.7.0"></script><script src="/js/copy.js?version=1.7.0"></script><script src="/js/fireworks.js?version=1.7.0"></script><script src="/js/transition.js?version=1.7.0"></script><script src="/js/scroll.js?version=1.7.0"></script><script src="/js/head.js?version=1.7.0"></script><script>if(/Android|webOS|iPhone|iPod|iPad|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
  $('#top-container').addClass('is-mobile')
}</script></body></html>